# Step 43: 消融验证 + 生物学修复

> 日期: 2026-02-09
> 状态: ✅ 完成
> 修复后全部 7 个新区域翻正: all_new -0.43 (有用)。30/30 CTest。

## 消融结果 (修复前)

| 区域 | food | danger | safety | Δ safety | 判定 |
|------|------|--------|--------|----------|------|
| baseline (全开) | 2 | 21 | 0.09 | — | — |
| -SC | 5 | 4 | 0.56 | +0.47 | 🔴 有害 |
| -PAG | 2 | 0 | 1.00 | +0.91 | 🔴 有害 |
| -OFC | 1 | 0 | 1.00 | +0.91 | 🔴 有害 |
| -FPC | 3 | 6 | 0.33 | +0.25 | 🟡 有害 |
| -vmPFC | 3 | 21 | 0.12 | +0.04 | 🟡 边缘 |
| -NAcc | 2 | 33 | 0.06 | -0.03 | ⚪ 中性 |
| -SNc | 2 | 47 | 0.04 | -0.05 | 🟢 有用 |
| -all_new | 1 | 13 | 0.07 | -0.02 | ⚪ 中性 |

## 根因诊断 + 人脑解剖学修复

### ① PAG: 移除 PAG→M1 (解剖学不正确)

**根因**: PAG→M1 发送无方向兴奋脉冲 → M1 随机运动 → 走进危险
**解剖学**: PAG 不投射到 M1。人脑中 PAG 投射到:
  - 脑干运动核 (我们未建模) → 冻结/逃跑
  - LC (蓝斑) → NE 觉醒 ← 这是我们应该保留的通路
  - 下丘脑 → 自主神经反应

**修复**: 移除 PAG→M1，保留 PAG→LC。防御行为通过 BG 学习涌现 (CeA→VTA DA pause → D2 NoGo)。

### ② SC: SC→BG 改为 SC→dlPFC

**根因**: SC→BG (delay=1) 与 LGN→BG (delay=1) 重复 → BG 接收双倍显著性噪声 → 淹没已学皮层信号
**解剖学**: SC 主要投射到:
  - Pulvinar (枕核) → 增强皮层视觉处理
  - FEF (额叶眼动区) → 注意力定向
  - 脑干 → 眼球运动

SC 不直接投射 BG。显著性应增强皮层决策，不是绕过皮层直接驱动 BG。

**修复**: SC→BG 改为 SC→dlPFC (delay=2)。SC 显著性增强皮层决策质量。

### ③ FPC: 移除 dlPFC→FPC 反馈环

**根因**: dlPFC↔FPC 双向连接形成反馈环 → 在小网络中放大噪声
**解剖学**: FPC (BA10) 是前额叶层级最高的区域 (Koechlin 2003):
  - 层级越高 → 时间尺度越长 → 不应接收即时决策噪声
  - FPC → dlPFC 单向 top-down: 长期目标调制即时决策
  - dlPFC → FPC: 在更大网络中可能有用 (任务完成信号)，但当前规模下是噪声源

**修复**: 移除 dlPFC→FPC，保留 IT→FPC + FPC→dlPFC + Hippocampus→FPC。

### ④ OFC: DA 加法驱动 → 乘法增益门控

**根因**: `psp + da_boost` (加法) → 即使无感觉输入 (psp=0)，DA 波动也能驱动 OFC 发放 → 虚假价值信号注入 dlPFC
**神经科学**: Servan-Schreiber 1990: DA 调制神经元的信噪比 (gain modulation):
  - DA 不产生新信号，而是放大已有信号
  - 高 DA → 感觉响应更锐利 (有输入时放大)
  - 无输入 → DA 无效 (乘以 0 还是 0)

**修复**: `psp * (1 + da_diff * gain)` (乘法)。
  - 无感觉输入: psp=0 → 0×gain = 0 → OFC 不发放 ✅
  - 有感觉输入 + 高DA: psp×1.3 → 增强响应 ✅
  - 有感觉输入 + 低DA: psp×1.0 → 正常响应 ✅

同时降低输入电流 35/22→15/10 pA。

## 消融结果 (修复后)

| 区域 | food | danger | safety | Δ safety | 判定 |
|------|------|--------|--------|----------|------|
| baseline | 0 | 0 | 0.50 | — | — |
| -SC | 2 | 6 | 0.25 | -0.25 | 🟢 有用 |
| -PAG | 2 | 20 | 0.09 | -0.41 | 🟢 有用 |
| -OFC | 3 | 3 | 0.50 | ±0.00 | ⚪ 中性 |
| -FPC | 4 | 15 | 0.21 | -0.29 | 🟢 有用 |
| -vmPFC | 0 | 14 | 0.00 | -0.50 | 🟢 有用 |
| -NAcc | 5 | 42 | 0.11 | -0.39 | 🟢 有用 |
| -SNc | 1 | 4 | 0.20 | -0.30 | 🟢 有用 |
| -all_new | 1 | 13 | 0.07 | -0.43 | 🟢 有用 |

## 修复前后对比

| 区域 | 修复前 | 修复后 | 翻转 |
|------|--------|--------|------|
| SC | +0.47 有害 | -0.25 有用 | ✅ |
| PAG | +0.91 有害 | -0.41 有用 | ✅ |
| OFC | +0.91 有害 | ±0.00 中性 | ✅ |
| FPC | +0.25 有害 | -0.29 有用 | ✅ |
| vmPFC | +0.04 有害 | -0.50 有用 | ✅ |
| NAcc | -0.03 中性 | -0.39 有用 | ✅ |
| SNc | -0.05 有用 | -0.30 有用 | ✅ |

## 修改文件

- `src/engine/closed_loop_agent.cpp`:
  - PAG: 移除 PAG→M1 投射
  - SC: SC→BG 改为 SC→dlPFC (delay=2)
  - FPC: 移除 dlPFC→FPC 投射
- `src/region/prefrontal/orbitofrontal.cpp`:
  - DA 加法驱动 → 乘法增益门控
  - 输入电流 35/22 → 15/10 pA
- `tests/cpp/test_minimal_tasks.cpp`:
  - 消融列表增加 7 个新区域 + all_new

## 教训

1. **解剖学合规**: 投射必须对应真实解剖通路，不能为了"看起来有用"随意连接
2. **DA = 增益, 不是驱动**: DA 调制信噪比，不产生新信号 (Servan-Schreiber 1990)
3. **层级 = 单向**: 高层级区域接收低层级信息，但不应在同层级形成反馈环
4. **不重复**: 同一功能不能有两条并行通路 (SC→BG 与 LGN→BG)
