# Step 24: 视觉层级接入闭环 — 从"背答案"到"学道理"

> 日期: 2026-02-08
> 状态: ✅ 完成

## 目标

V1→V2→V4→IT→dlPFC 替代 V1→dlPFC 直连，提供位置不变表征

## 生物学基础

人脑腹侧视觉通路 (ventral "what" pathway):
```
V1(边缘/方向) → V2(纹理/轮廓) → V4(形状/颜色) → IT(物体身份, 位置不变!)
```
IT 神经元对物体身份响应，不随物体位置/大小变化。这是泛化的硬件基础。

## 架构变更

**新增 3 个视觉区域 (复用 CorticalRegion, 零新代码):**

| 区域 | 缩放 | 神经元数 (5×5 vision) | STDP | 功能 |
|------|------|---------------------|------|------|
| V2 | 0.7× V1 | ~238 | ON | 纹理/轮廓学习 |
| V4 | 0.5× V1 | ~134 | ON | 形状/颜色学习 |
| IT | 0.35× V1 | ~75 | **OFF** | 不变性表征 (稳定性优先) |

**投射重组 (替代 V1→dlPFC 直连):**
```
前馈: LGN→V1→V2→V4→IT→dlPFC (每级 delay=2)
反馈: V2→V1, V4→V2, IT→V4, dlPFC→IT (每级 delay=3)
杏仁核: V1→Amyg(快, delay=2) + IT→Amyg(慢, delay=3) (双通路恐惧)
海马: IT→Hippocampus (不变性物体记忆, 替代 V1→Hippocampus)
```

**brain_steps: 15→20** (流水线延迟: LGN→V1→V2→V4→IT→dlPFC→BG ≈ 14 步)

## 泛化测试结果

| 指标 | Step 23 (V1→dlPFC) | **Step 24 (V1→V2→V4→IT→dlPFC)** | 变化 |
|------|--------------------|---------------------------------|------|
| 泛化优势 | **-0.069** ❌ | **+0.042** ✅ | **翻转!** |
| trained safety | 0.515 | 0.440 | -0.075 |
| fresh safety | 0.584 | 0.398 | -0.186 |
| 结论 | 训练有害 | **训练有帮助** | 根本性转变 |

**从"背答案"变成了"学道理"!**

- 训练过的 agent (trained=0.440) 比未训练 (fresh=0.398) 好 4.2%
- seed=123: trained=0.40 > fresh=0.32 (Δ=+0.08, 显著优势)
- 证明 IT 层级抽象让 DA-STDP 学到了位置不变的食物/危险策略

## 其他测试数据

```
Test 1 (5k): improvement +0.07, late safety 0.47 (正向学习)
Test 4 (10k): improvement -0.011 (基本稳定, 略有退化)
Test 5 (15×15): improvement +0.142 (大环境正向学习!)
Brain: V1=447, V2=238, V4=134, IT=75, dlPFC=223, LGN=100
```

## 回归测试: 28/28 CTest 全通过 (run_evolution.exe 文件锁, 非代码问题)

## 系统状态

```
50+3区域 (V2/V4/IT) · ~1100 闭环神经元 · ~120投射
视觉层级: LGN→V1→V2→V4→IT→dlPFC (逐级抽象, 位置不变表征)
泛化: ✅ 训练有帮助 (+0.042), 从"背答案"转为"学道理"
15×15大环境: improvement +0.142 (视觉层级在大环境优势明显)
```
