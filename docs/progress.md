# æ‚ŸéŸµ (WuYun) v3 å¼€å‘è¿›åº¦

> ä¸Šæ¬¡æ›´æ–°: 2026-02-07
> ä»“åº“: https://github.com/1600822305/wuyun (agi3 = main, agi2 = v2 åˆ†æ”¯)

---

## å·²å®Œæˆ

### è®¾è®¡æ–‡æ¡£ (v0.3, 2026-02-07)
- âœ… å››ä»½è®¾è®¡æ–‡æ¡£æ ¡å¯¹å®Œæ¯• (00è®¾è®¡åŸåˆ™ / 01è„‘åŒºè®¡åˆ’ / 02ç¥ç»å…ƒç³»ç»Ÿ / 03é¡¹ç›®ç»“æ„)
- âœ… 01è„‘åŒºæ–‡æ¡£æŒ‰çœŸå®è§£å‰–åˆ†åŒºé‡ç»„ (å‰è„‘â†’ç«¯è„‘/é—´è„‘ | ä¸­è„‘ | åè„‘)
- âœ… 01è„‘åŒºæ–‡æ¡£å‡çº§è‡³ **NextBrain æ··åˆæ–¹æ¡ˆ**: çš®å±‚(åŠŸèƒ½åˆ†åŒº) + çš®å±‚ä¸‹(NextBrain, Nature 2025)
  - ä¸˜è„‘ 16æ ¸å›¢ | æä»æ ¸ 8æ ¸å›¢ | æµ·é©¬ 7äºšåŒº | ä¸­è„‘ 11æ ¸å›¢ | å°è„‘ 8å°å¶åŒº
  - æ€»åˆ†åŒº: **~97åŒº** (çš®å±‚25 + çš®å±‚ä¸‹72)ï¼Œæ¯ä¸ªçš®å±‚ä¸‹æ ¸å›¢æ ‡æ³¨ FreeSurfer ç¼–å·

### P0 Python åŸå‹ (2026-02-07) â†’ å·²å½’æ¡£ä¸ºç®—æ³•å‚è€ƒ
- âœ… `wuyun/spike/` â€” SpikeTypeã€Spikeã€SpikeBusã€OscillationClock
- âœ… `wuyun/synapse/` â€” SynapseBaseã€STPã€STDPã€DA-STDPã€æŠ‘åˆ¶æ€§STDPã€ç¨³æ€å¯å¡‘æ€§
- âœ… `wuyun/neuron/` â€” NeuronBase(16ç§å‚æ•°é¢„è®¾)ã€åŒåŒºå®¤Compartment
- âœ… `wuyun/core/` â€” å‘é‡åŒ– NeuronPopulationã€SynapseGroup
- â†’ å½’æ¡£è‡³ `_archived/python_prototype/`ï¼Œæ•°å­¦æ–¹ç¨‹ä¸å˜ï¼ŒC++ é‡æ–°å®ç°

### æ¶æ„å†³ç­–: C++ æ ¸å¿ƒå¼•æ“ (2026-02-07)
- âœ… å†³å®š: ä»¿çœŸæ ¸å¿ƒç”¨ **C++17**ï¼ŒPython åªåšé…ç½®/å®éªŒ/å¯è§†åŒ–
- âœ… ç†ç”±: Python 100ä¸‡ç¥ç»å…ƒ ~10ç§’/step ä¸å¯ç”¨; C++ ~10-50ms/step æ¥è¿‘å®æ—¶; æœªæ¥è¿ç§» CUDA å®¹æ˜“
- âœ… 03é¡¹ç›®ç»“æ„æ–‡æ¡£é‡å†™ä¸º C++ core + pybind11 + Python å®éªŒå±‚ (v0.4)
- âœ… æŠ€æœ¯æ ˆ: C++17 / CMake / pybind11 / Google Test / SoAå¸ƒå±€ / CSRç¨€ç– / äº‹ä»¶é©±åŠ¨

---

## å¾…å¼€å§‹

> ç¥ç»å…ƒ+çªè§¦ â†’ çš®å±‚æŸ± â†’ æ ¸å¿ƒå›è·¯ â†’ æ‰©å±•è„‘åŒº â†’ å¸ƒçº¿ â†’ æ¶Œç°

### Step 1: C++ å·¥ç¨‹éª¨æ¶ + åŸºç¡€éªŒè¯ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step01_foundation.md](steps/step01_foundation.md)

C++17 æ ¸å¿ƒå¼•æ“: SoA åŒåŒºå®¤ AdLIF+ ç¾¤ä½“ + CSR ç¨€ç–çªè§¦ + STDP/STPã€‚
9 æµ‹è¯•é€šè¿‡ã€‚æ€§èƒ½: 10K ç¥ç»å…ƒ 146Î¼s/step, 1M ç¥ç»å…ƒ 26ms/stepã€‚

### Step 2 + 2.5: çš®å±‚æŸ±æ¨¡æ¿ + åœ°åŸºè¡¥å…¨ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step02_cortical_column.md](steps/step02_cortical_column.md)

6 å±‚çš®å±‚æŸ± (18 ç»„çªè§¦) + NMDA MgÂ²âº é˜»æ–­ + SpikeBus + DA-STDP + ç¥ç»è°ƒè´¨ + 8 ç§ç¥ç»å…ƒã€‚21 æµ‹è¯•é€šè¿‡ã€‚

### Step 3 + 3.5: æœ€å°å¯å·¥ä½œå¤§è„‘ + åä½œå¼Šä¿®å¤ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step03_minimal_brain.md](steps/step03_minimal_brain.md)

LGNâ†’V1â†’dlPFCâ†’BGâ†’M1 å®Œæ•´é€šè·¯ + VTA DAã€‚7 åŒºåŸŸ 906 ç¥ç»å…ƒã€‚
åä½œå¼Š: BG éšæœºæ˜ å°„æ›¿ä»£ç¡¬ç¼–ç ã€‚26 æµ‹è¯•é€šè¿‡ã€‚

### Step 4 ç³»åˆ—: æµ·é©¬ + æä»æ ¸ + å­¦ä¹ ç³»ç»Ÿ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step04_memory_learning.md](steps/step04_memory_learning.md)

æµ·é©¬ (ECâ†’DGâ†’CA3â†’CA1, æ¨¡å¼è¡¥å…¨ 100%), æä»æ ¸ (ææƒ§æ¡ä»¶åŒ–, ITC æ¶ˆé€€ 96%),
STDP è‡ªç»„ç»‡ (86 ç¥ç»å…ƒå‘å±•é€‰æ‹©æ€§), BG DA-STDP (åŠ¨ä½œé€‰æ‹©+åè½¬å­¦ä¹ ),
9 åŒºåŸŸç«¯åˆ°ç«¯å­¦ä¹  (3 å¥—å­¦ä¹ ç³»ç»ŸåŒæ—¶è¿è¡Œ)ã€‚
è¡¥å…¨: SeptalNucleus (theta 6.7Hz), MammillaryBody (Papez å›è·¯),
Hippocampus/Amygdala æ‰©å±• (Presub/HATA/MeA/CoA/AB)ã€‚24åŒºåŸŸ, 40æŠ•å°„ã€‚
**é‡Œç¨‹ç¢‘: ä»"é€šç”µçš„ç¡¬ä»¶"å˜ä¸º"èƒ½å­¦ä¹ çš„ç³»ç»Ÿ"ã€‚** 100 æµ‹è¯•é€šè¿‡ã€‚

### ä¿®å¤: V1â†’dlPFCâ†’BG ä¿¡å·è¡°å‡ âœ… (2026-02-07)

fan-out 3â†’30%Ã—L4, PSP 25fâ†’35f, å…¨é“¾è·¯æ‰“é€š (V1=7656â†’dlPFC=4770â†’BG=3408â†’M1=1120)ã€‚57 æµ‹è¯•é€šè¿‡ã€‚

### Step 5 ç³»åˆ—: æ‰©å±•è„‘åŒº + è°ƒè´¨ + å°è„‘ + å†³ç­– + ä¸˜è„‘ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step05_extended_brain.md](steps/step05_extended_brain.md)

LC/DRN/NBM 4å¤§è°ƒè´¨å¹¿æ’­, V2/V4/IT è…¹ä¾§è§†è§‰å±‚çº§, å°è„‘ CF-LTD (ç¬¬4ç§å­¦ä¹ ),
OFC/vmPFC/ACC å†³ç­–ä¸‰è§’, MT/PPC èƒŒä¾§è§†è§‰ (åŒæµ what+where),
13ä¸ªçš®å±‚åŒº + 9ä¸ªä¸˜è„‘æ ¸ (46åŒºåŸŸ, 5409n, ~90æŠ•å°„)ã€‚121 æµ‹è¯•é€šè¿‡ã€‚

### Step 6 ç³»åˆ—: é¢„æµ‹ç¼–ç  + ä¸‹ä¸˜è„‘å†…é©±åŠ› + æ„è¯†(GNW) âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step06_predictive_drive.md](steps/step06_predictive_drive.md)

é¢„æµ‹ç¼–ç æ¡†æ¶ (Rao-Ballard + Friston, NE/AChç²¾åº¦åŠ æƒ),
ä¸‹ä¸˜è„‘ 6æ ¸å›¢ (SCN/VLPO/Orexin/PVN/LH/VMH, sleep-wake flip-flop),
GNW æ„è¯†æ¨¡å‹ (ç«äº‰â†’ç‚¹ç«â†’å¹¿æ’­, 9ç«äº‰+2å¹¿æ’­æŠ•å°„)ã€‚
48åŒºåŸŸ, 5528n, ~109æŠ•å°„ã€‚135 æµ‹è¯•é€šè¿‡ã€‚

### Step 7: Python ç»‘å®š + å¯è§†åŒ–ä»ªè¡¨ç›˜ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step07_python_bindingsvisual.md](steps/step07_python_bindingsvisual.md)

pybind11 æš´éœ²å…¨éƒ¨ 11 ç§ BrainRegion å­ç±», SpikeRecorder, build_standard_brain()ã€‚
matplotlib å¯è§†åŒ–: raster/connectivity/activity/neuromod 4 ç§å›¾è¡¨ã€‚86 æµ‹è¯•é€šè¿‡ã€‚

### Step 8: ç¡çœ  / æµ·é©¬é‡æ”¾ / è®°å¿†å·©å›º âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step08_sleep_replay.md](steps/step08_sleep_replay.md)

æµ·é©¬ SWR é‡æ”¾ (CA3 è‡ªè”æƒ³), çš®å±‚ NREM æ…¢æ³¢ (Up/Down ~1Hz), è®°å¿†å·©å›ºé€šè·¯ã€‚
48åŒºåŸŸ, 5528n, ~109æŠ•å°„ã€‚142 æµ‹è¯•é€šè¿‡ã€‚

### Step 9: è®¤çŸ¥ä»»åŠ¡ + æ„Ÿè§‰è¾“å…¥ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step09_sensory_cognitive.md](steps/step09_sensory_cognitive.md)

Go/NoGo + æƒ…ç»ªå¤„ç† + Stroop å†²çª 3 é¡¹è®¤çŸ¥èŒƒå¼éªŒè¯ã€‚
VisualInput (center-surround ON/OFF) + AuditoryInput (tonotopic onset)ã€‚149 æµ‹è¯•é€šè¿‡ã€‚

### Step 10 ç³»åˆ—: å·¥ä½œè®°å¿† + è®¤çŸ¥éªŒè¯ + æ³¨æ„åŠ› + è§„æ¨¡æ‰©å±• âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step10_wm_scale.md](steps/step10_wm_scale.md)

dlPFC L2/3 å¾ªç¯è‡ªæŒ + DA ç¨³å®šå·¥ä½œè®°å¿†, BG DA-STDP åœ¨çº¿å­¦ä¹ ,
6 é¡¹è®¤çŸ¥ä»»åŠ¡éªŒè¯ (DMTS/Go-NoGo/Papez/æƒ…ç»ªè®°å¿†/WM+BG/åè½¬),
VIP å»æŠ‘åˆ¶æ³¨æ„åŠ› + NE/ACh ç²¾åº¦è°ƒåˆ¶,
build_standard_brain(scale) å‚æ•°åŒ– (1/3/8Ã—, 5.5k~44k ç¥ç»å…ƒ)ã€‚154 æµ‹è¯•é€šè¿‡ã€‚

### Step 11: REM ç¡çœ  + æ¢¦å¢ƒ âœ… (2026-02-07)
> è¯¦ç»†æ–‡æ¡£: [steps/step11_rem_sleep.md](steps/step11_rem_sleep.md)

SleepCycleManager (AWAKEâ†’NREMâ†’REM å‘¨æœŸ), çš®å±‚å»åŒæ­¥åŒ– + PGO æ³¢ + è¿åŠ¨æŠ‘åˆ¶,
æµ·é©¬ theta (~6Hz) + åˆ›é€ æ€§é‡ç»„ã€‚161 æµ‹è¯•é€šè¿‡ã€‚

---

## æ¶æ„å¤‡å¿˜

```
C++ å·¥ç¨‹éª¨æ¶ + åŸºç¡€éªŒè¯  â† Step 1: CMake + core/ + pybind11
     â†“
çš®å±‚æŸ±æ¨¡æ¿ (6å±‚, C++)    â† Step 2: circuit/cortical_column
     â†“
æ ¸å¿ƒå›è·¯ (æœ€å°å¤§è„‘)       â† Step 3: V1+PFC+BG+ä¸˜è„‘4æ ¸+DA
     â†“
è®°å¿†+æƒ…æ„Ÿ                 â† Step 4: æµ·é©¬7åŒº+æä»æ ¸8æ ¸+Papez
     â†“
æ‰©å±•çš®å±‚+ä¸˜è„‘             â† Step 5: 25çš®å±‚åŒº+ä¸˜è„‘å…¨16æ ¸
     â†“
è°ƒè´¨+å†…é©±åŠ›+å°è„‘          â† Step 6: 5-HT/NE/ACh+ä¸‹ä¸˜è„‘+å°è„‘8å¶
     â†“
ç¡çœ /æµ·é©¬é‡æ”¾             â† Step 8: SWR + çš®å±‚æ…¢æ³¢ + è®°å¿†å·©å›º
     â†“
æ„Ÿè§‰è¾“å…¥æ¥å£              â† Step 9: VisualInput + AuditoryInput
     â†“
è§„æ¨¡æ‰©å±•éªŒè¯              â† Step 10: scale=1/3/8, æ¶Œç°ç‰¹æ€§
     â†“
REMç¡çœ +æ¢¦å¢ƒ              â† Step 11: theta + PGO + åˆ›é€ æ€§é‡ç»„

ç¨³æ€å¯å¡‘æ€§é›†æˆ              â† Step 13-A: SynapticScaler + E/Iå¹³è¡¡
     â†“
é—­ç¯Agent + GridWorld        â† Step 13-B: æ„ŸçŸ¥â†’å†³ç­–â†’è¡ŒåŠ¨â†’å­¦ä¹ 
     â†“
é—­ç¯å­¦ä¹ è°ƒä¼˜ (v3)            â† Step 13-B++: elig clamp + NEé€€ç« + è¯Šæ–­ä¿®å¤
     â†“
è§†è§‰é€šè·¯ä¿®å¤ + çš®å±‚STDP      â† Step 13-C: LGNâ†’V1â†’dlPFCæ‹“æ‰‘æ˜ å°„ + V1 STDP

æŠ€æœ¯æ ˆ: C++17 æ ¸å¿ƒå¼•æ“ + pybind11 â†’ Python å®éªŒ/å¯è§†åŒ–
Python åŸå‹ (wuyun/) â†’ _archived/ ç®—æ³•å‚è€ƒ
```

---

### Step 13 ç³»åˆ—: é—­ç¯ Agent + GridWorld + å­¦ä¹ è°ƒä¼˜ âœ… (2026-02-07~08)
> è¯¦ç»†æ–‡æ¡£: [steps/step13_closed_loop.md](steps/step13_closed_loop.md)

13-A ç¨³æ€å¯å¡‘æ€§ (Scale=3 WM æ¢å¤), 13-B GridWorld é—­ç¯ Agent,
13-B+/B++ DA-STDP ä¿®å¤ (eligibility traces + Phase A/B/C + NE è°ƒåˆ¶),
13-C è§†è§‰é€šè·¯ä¿®å¤ (LGN gain + æ‹“æ‰‘æ˜ å°„ + V1 STDP),
13-D+E dlPFCâ†’BG æ‹“æ‰‘ (78% åŒ¹é… + efference copy)ã€‚
improvement +0.191, learner advantage +0.017, food +55%ã€‚29/29 CTestã€‚


---

# æˆ˜ç•¥è·¯çº¿å›¾ï¼šä»"ç»„ä»¶å †å "åˆ°"å®Œæ•´å­¦ä¹ ç³»ç»Ÿ"

> æ—¥æœŸ: 2026-02-08
> å†³ç­–ä¾æ®: Step 11-13 çš„åå¤è°ƒä¼˜ç»éªŒ + ç”Ÿç‰©å­¦ä¹ å›è·¯åˆ†æ

## ç°çŠ¶è¯Šæ–­

ç»è¿‡ Step 11 â†’ 13-D+E çš„æŒç»­ä¼˜åŒ–ï¼Œæ‚ŸéŸµçš„é—­ç¯ agent è¾¾åˆ°:

| æŒ‡æ ‡ | å½“å‰å€¼ | è¯´æ˜ |
|------|--------|------|
| 5k safety æå‡ | 0.32 â†’ 0.50 (+0.18) | å‹‰å¼ºå­¦ä¼š |
| Learner advantage | +0.0015 | å‡ ä¹çœ‹ä¸å‡ºå­¦å’Œä¸å­¦çš„åŒºåˆ« |
| Food 10k | 118 (vs åŸºçº¿ 76) | è§†è§‰é€šè·¯è´¡çŒ® +55% |
| 10k improvement | +0.077 | å¾®å¼±æ­£å‘ |

**æ ¸å¿ƒé—®é¢˜: ç»„ä»¶æ˜¯ç‹¬ç«‹çš„ç‰¹æ€§ï¼Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­¦ä¹ ç³»ç»Ÿã€‚**

å†å²æ¨¡å¼: æ¯ä¸€æ­¥éƒ½æ˜¯"ä¿®ä¸€ä¸ªç“¶é¢ˆï¼Œæš´éœ²ä¸‹ä¸€ä¸ªç“¶é¢ˆ"ã€‚è¿™è¯´æ˜ç³»ç»Ÿç¼ºå°‘æ ¸å¿ƒå­¦ä¹ èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¼ºå°‘è°ƒå‚ã€‚

## ä¸‰ä¸ªæ ¹æœ¬ç“¶é¢ˆ

### ç“¶é¢ˆ 1: ä¿¡ç”¨åˆ†é…å¤ªå¼±ï¼ˆæœ€å…³é”®ï¼‰

DA-STDP + eligibility trace æ˜¯ç”Ÿç‰©å­¦ä¸Šæ­£ç¡®çš„ï¼Œä½†æå…¶ä½æ•ˆ:
- æ¯æ¬¡å¥–åŠ±äº‹ä»¶åªå­¦ä¹  1 æ¬¡
- 3 æ­¥å‰æœ‰ 100 ä¸ªç¥ç»å…ƒæ´»è·ƒï¼Œåªæœ‰ 5 ä¸ªä¸æ­£ç¡®åŠ¨ä½œç›¸å…³
- Eligibility trace ä¸çŸ¥é“å“ª 5 ä¸ªæ˜¯å…³é”®çš„ â†’ 95% çš„æƒé‡æ›´æ–°æ˜¯å™ªå£°

çœŸå®å¤§è„‘é å¤šé‡æœºåˆ¶å åŠ è§£å†³:

| æœºåˆ¶ | åŠŸèƒ½ | æ‚ŸéŸµç°çŠ¶ | ç”Ÿç‰©å¯¹åº” |
|------|------|---------|---------|
| **æµ·é©¬ SWR é‡æ”¾** | 1 æ¬¡ç»éªŒ â†’ é‡æ”¾ 20 æ¬¡å­¦ä¹  | âŒ æœ‰æµ·é©¬ä½†æ—  SWR | experience replay |
| **é¢„æµ‹ç¼–ç ** | è‡ªä¸Šè€Œä¸‹è¯¯å·®ä¿¡å·ï¼Œå‡å°‘å™ªå£°æ¿€æ´» | âŒ æœ‰ç»“æ„ä½†æœªæ¥é€š | ç”Ÿç‰©ç‰ˆ backprop |
| **å‰é¢å¶å·¥ä½œè®°å¿†æ¡¥æ¥** | åœ¨ DA åˆ°æ¥å‰ç»´æŒ"è°åšäº†ä»€ä¹ˆ" | âš ï¸ æœ‰ä½†æå¼± | temporal credit |
| **å°è„‘å‰å‘æ¨¡å‹** | é¢„æµ‹åŠ¨ä½œç»“æœï¼Œä¸éœ€ç­‰çœŸå®å¥–åŠ± | âŒ å®Œå…¨æ²¡æœ‰ | model-based RL |

**æ‚ŸéŸµåšäº†å­¦ä¹ å›è·¯çš„ â‘ -â‘¥ï¼Œç¼ºäº† â‘¦-â‘©:**

```
å®Œæ•´å­¦ä¹ å›è·¯ (10æ­¥):
â‘  çœ‹åˆ°é£Ÿç‰©åœ¨å·¦    â†’ V1 æ¿€æ´» "å·¦ä¾§é£Ÿç‰©" ç‰¹å¾               â† æœ‰
â‘¡ V1â†’dlPFC        â†’ dlPFC å½¢æˆ "é£Ÿç‰©åœ¨å·¦" è¡¨å¾             â† æœ‰
â‘¢ dlPFCâ†’BG        â†’ BG D1 "å‘å·¦" å­ç¾¤è¢«æ¿€æ´»                â† æœ‰ (æ‹“æ‰‘æ˜ å°„)
â‘£ BGâ†’M1           â†’ Agent å‘å·¦èµ°                          â† æœ‰
â‘¤ åƒåˆ°é£Ÿç‰©        â†’ VTA DA burst                          â† æœ‰
â‘¥ DA-STDP         â†’ å¼ºåŒ– "é£Ÿç‰©åœ¨å·¦â†’å‘å·¦èµ°" è¿æ¥             â† æœ‰
---- ä»¥ä¸‹ç¼ºå¤± ----
â‘¦ æµ·é©¬è®°å½•äº‹ä»¶    â†’ æŠŠæ•´ä¸ª episode å­˜ä¸º CA3 pattern          â† ç¼º
â‘§ æµ·é©¬é‡æ”¾ Ã—20    â†’ ç©ºé—²æ—¶åå¤å›æ”¾æ­¤ episode                 â† ç¼º
   æ¯æ¬¡é‡æ”¾è§¦å‘ â‘¥ â†’ 1æ¬¡ç»éªŒå˜20æ¬¡å­¦ä¹ 
â‘¨ çš®å±‚å·©å›º        â†’ V1â†’dlPFC è¿æ¥è¢«é‡æ”¾å¼ºåŒ–ä¸ºé•¿æœŸè®°å¿†         â† ç¼º
â‘© é¢„æµ‹ç¼–ç         â†’ ä¸‹æ¬¡çœ‹åˆ°ç±»ä¼¼åœºæ™¯,dlPFCä¸»åŠ¨é¢„æµ‹"ä¼šæœ‰é£Ÿç‰©"   â† ç¼º
   é¢„æµ‹æˆåŠŸ=ä¸éœ€å­¦ä¹ , é¢„æµ‹å¤±è´¥=è¯¯å·®ä¿¡å·â†’ç²¾å‡†æ›´æ–°
```

### ç“¶é¢ˆ 2: è¡¨å¾å®¹é‡å¤ªå°

é—­ç¯å†³ç­–å®é™…å‚ä¸çš„ ~600 ä¸ªç¥ç»å…ƒï¼Œä¿¡æ¯å®¹é‡çº¦ç­‰äº 3 å±‚ 30 èŠ‚ç‚¹å‰é¦ˆç½‘ç»œã€‚
ç”¨è¿™ä¸ªå®¹é‡ + eligibility trace (éæ¢¯åº¦ä¸‹é™) å­¦ GridWorld ... è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå­¦å¾—è‰°éš¾ã€‚

### ç“¶é¢ˆ 3: æ¶æ„æ˜¯æ‰‹å·¥æ­çš„

æ‰‹å·¥æ­çš„æ¶æ„é™åˆ¶äº†è¿›åŒ–/ä¼˜åŒ–åªèƒ½è°ƒå‚æ•°ã€‚é—´æ¥ç¼–ç ï¼ˆå‘è‚²ç¨‹åºï¼‰æ‰èƒ½è®©è¿›åŒ–å‘ç°æ–°æ¶æ„ã€‚è¿™æ˜¯è¿œæœŸç›®æ ‡ã€‚

## æŠ€æœ¯è·¯çº¿ï¼šå…ˆå®Œæˆå­¦ä¹ å›è·¯ï¼Œå†ä¼˜åŒ–å‚æ•°ï¼Œå†å¢åŠ ç¯å¢ƒ

### æ­£ç¡®çš„ç›®æ ‡é€’è¿›

```
é”™è¯¯è·¯çº¿: GridWorld 5Ã—5 â†’ 10Ã—10 â†’ è¿ç»­ç©ºé—´ â†’ 3D â†’ ...
  ï¼ˆç¯å¢ƒå˜å¤æ‚ï¼Œä½†å­¦ä¹ èƒ½åŠ›æ²¡å˜ â†’ æ¯æ¬¡éƒ½è¦å¤§æ”¹ï¼‰

æ­£ç¡®è·¯çº¿: å®Œæ•´å­¦ä¹ å›è·¯ â†’ å‚æ•°ä¼˜åŒ– â†’ æ›´å¤æ‚ç¯å¢ƒ
  ï¼ˆå­¦ä¹ èƒ½åŠ›å…ˆåˆ°ä½ï¼Œç¯å¢ƒè‡ªç„¶å¯ä»¥æ‰©å±•ï¼Œæ¯æ­¥å·¥ä½œä¸ä¼šè¢«æ¨ç¿»ï¼‰
```

### Step 14: æµ·é©¬ SWR é‡æ”¾ï¼ˆROI æœ€é«˜çš„å•ä¸€æ”¹è¿›ï¼‰

**ä¼˜å…ˆçº§: ğŸ”´ æœ€é«˜**

```
ç°çŠ¶: Hippocampus æœ‰ ECâ†’DGâ†’CA3â†’CA1 ç»“æ„ï¼Œä½†åªåšå•å‘ç¼–ç 
ç¼ºå¤±: Sharp-Wave Ripple é‡æ”¾æœºåˆ¶

æ ¸å¿ƒè®¾è®¡:
  - Agent åƒåˆ°é£Ÿç‰©æˆ–é‡åˆ°å±é™©æ—¶ï¼Œè§¦å‘ SWR äº‹ä»¶
  - ç»´æŠ¤æœ€è¿‘ ~50 æ­¥çš„ episode buffer (æ¯æ­¥çš„ spike pattern å¿«ç…§)
  - SWR è§¦å‘æ—¶: ä» buffer å–æœ€è¿‘çš„å¥–åŠ±ç›¸å…³ episode
  - CA3 è‡ªè”æƒ³ç½‘ç»œé‡æ”¾è¯¥ episode çš„ spike åºåˆ— (å‹ç¼©æ—¶é—´å°ºåº¦)
  - é‡æ”¾çš„ spikes é€šè¿‡ SpikeBus ä¼ å› BG
  - BG åŒæ—¶æ”¶åˆ° DA (å› ä¸ºé‡æ”¾çš„æ˜¯å¥–åŠ±äº‹ä»¶)
  - â†’ DA-STDP å†æ¬¡æ›´æ–°æƒé‡
  - é‡æ”¾ 10-20 æ¬¡ â†’ 1æ¬¡é£Ÿç‰©äº‹ä»¶å˜æˆ 10-20 æ¬¡æƒé‡æ›´æ–°

é¢„æœŸæ•ˆæœ:
  - å­¦ä¹ é€Ÿåº¦ Ã—5-10
  - Learner advantage ä» +0.001 åˆ° +0.01-0.05
  - 5k safety ä» 0.50 â†’ 0.70+

å·¥æœŸ: 3-5 å¤©
æ˜¯å¦ä¼šè¢«æ¨ç¿»: ä¸ä¼š â€” ä»»ä½•æœªæ¥ç‰ˆæœ¬éƒ½éœ€è¦ SWR é‡æ”¾
```

### Step 15: é¢„æµ‹ç¼–ç æ¥é€šï¼ˆä¿¡ç”¨åˆ†é…ç²¾åº¦æå‡ï¼‰

**ä¼˜å…ˆçº§: ğŸŸ¡ é«˜**

```
ç°çŠ¶: L6 å­˜åœ¨ä½†ä¸äº§ç”Ÿè‡ªä¸Šè€Œä¸‹é¢„æµ‹
ç¼ºå¤±: dlPFCâ†’LGN/V1 çš„é¢„æµ‹ä¿¡å·ï¼ŒV1 L2/3 çš„é¢„æµ‹è¯¯å·®è®¡ç®—

æ ¸å¿ƒè®¾è®¡:
  - dlPFC L6 â†’ thalamus(LGN) â†’ V1: è‡ªä¸Šè€Œä¸‹çš„é¢„æµ‹ä¿¡å·
  - V1 L2/3 è®¡ç®—: å®é™…è¾“å…¥ âˆ’ é¢„æµ‹ = é¢„æµ‹è¯¯å·®
  - åªæœ‰é¢„æµ‹è¯¯å·®æ‰å‘ä¸Šä¼ æ’­ (è€Œéå…¨éƒ¨è§†è§‰è¾“å…¥)
  - â†’ å¤§å¹…å‡å°‘ dlPFCâ†’BG çš„å™ªå£°æ¿€æ´»
  - â†’ DA-STDP ä¿¡ç”¨åˆ†é…æ›´ç²¾å‡†

é¢„æœŸæ•ˆæœ:
  - ä¿¡ç”¨åˆ†é…ç²¾åº¦ Ã—2-3
  - ä¸ SWR é‡æ”¾å åŠ å: learner advantage å¯èƒ½è¾¾åˆ° +0.05-0.10

å·¥æœŸ: 5-7 å¤©
æ˜¯å¦ä¼šè¢«æ¨ç¿»: ä¸ä¼š â€” é¢„æµ‹ç¼–ç æ˜¯çš®å±‚è®¡ç®—çš„æ ¸å¿ƒç†è®º
```

### Step 16: åŸºå› å±‚ v1ï¼ˆå‚æ•°è‡ªåŠ¨ä¼˜åŒ–ï¼‰

**ä¼˜å…ˆçº§: ğŸŸ¢ ä¸­**

```
å‰ç½®: Step 14 + 15 å®Œæˆåï¼Œå­¦ä¹ å›è·¯å®Œæ•´
è¿™æ—¶åŸºå› å±‚æ‰èƒ½å‘æŒ¥æœ€å¤§ä»·å€¼:
  - æœç´¢çš„æ˜¯"å®Œæ•´å­¦ä¹ ç³»ç»Ÿçš„æœ€ä¼˜å‚æ•°"
  - è€Œé"æ®‹ç¼ºç³»ç»Ÿçš„æœ€ä¼˜ workaround"

æ ¸å¿ƒè®¾è®¡:
  - è¯¦è§ docs/04_genome_layer_design.md
  - v1: çº¯é—ä¼ ç®—æ³•, ~30-150 ä¸ªé—­ç¯å‚æ•°
  - é€‚åº”åº¦å‡½æ•°: æ˜¾å¼å¥–åŠ±å­¦ä¹ æ”¹å–„å¹…åº¦ (Baldwin æ•ˆåº”)

é¢„æœŸæ•ˆæœ:
  - åœ¨å®Œæ•´å­¦ä¹ å›è·¯ä¸Šå†æŒ¤å‡º 30-50% æ€§èƒ½
  - å‘ç°å‚æ•°é—´çš„ååŒæ•ˆåº”

å·¥æœŸ: 2-3 å¤©
```

### Step 17+: ç¯å¢ƒæ‰©å±•

```
å­¦ä¹ å›è·¯å®Œæ•´ + å‚æ•°ä¼˜åŒ–å:
  - 10Ã—10 Grid, ç§»åŠ¨é£Ÿç‰©
  - å¤šæ­¥åºåˆ—ä»»åŠ¡
  - è¿ç»­ç©ºé—´
  â†’ ä¸éœ€è¦æ”¹å­¦ä¹ æœºåˆ¶ï¼Œåªéœ€è¦è°ƒç¯å¢ƒå‚æ•°
```

## æ ¸å¿ƒåŸåˆ™

1. **å…ˆå®Œæˆå­¦ä¹ å›è·¯ï¼Œå†ä¼˜åŒ–å‚æ•°** â€” åŸºå› å±‚æ˜¯"æ•ˆç‡æ”¾å¤§å™¨"ä¸æ˜¯"èƒ½åŠ›çªç ´å™¨"
2. **æ¯æ­¥å·¥ä½œå¿…é¡»æ˜¯æ°¸ä¹…æ€§çš„** â€” ä¸ä¼šå› ä¸ºä¸‹ä¸€æ­¥è€Œè¢«æ¨ç¿»
3. **æ¶æ„å†³ç­–ç”±äººåšï¼Œå‚æ•°ä¼˜åŒ–ç”±è¿›åŒ–åš** â€” è¿›åŒ–ä¸è§£å†³æ¶æ„é—®é¢˜
4. **ä¸ä¼šè¢«æ¨ç¿»çš„**: SNN åŸºç¡€è®¾æ–½ã€è„‘åŒºç»“æ„ã€æ‹“æ‰‘æ˜ å°„ã€DA-STDPã€SpikeBus
5. **è®©ä¹‹å‰çš„å·¥ä½œå¢å€¼ 10 å€çš„**: SWR é‡æ”¾ã€é¢„æµ‹ç¼–ç 

## ä¸ä¼šè¢«æ¨ç¿»çš„å·²æœ‰å·¥ä½œï¼ˆé•¿æœŸæœ‰æ•ˆï¼‰

- âœ… 48 è„‘åŒºç»“æ„ + SNN + åŒåŒºå®¤æ¨¡å‹
- âœ… DA-STDP ä¸‰å› å­å­¦ä¹  (æ˜¯æœ€ç»ˆç³»ç»Ÿçš„ä¸€éƒ¨åˆ†)
- âœ… å…¨é“¾è·¯æ‹“æ‰‘æ˜ å°„ V1â†’dlPFCâ†’BG (Step 13-C/D)
- âœ… SpikeBus + SimulationEngine åŸºç¡€è®¾æ–½
- âœ… è§†è§‰é€šè·¯ LGNâ†’V1â†’dlPFC (Step 13-C)
- âœ… Motor efference copy (Step 13-D)
- âœ… Awake SWR Replay (Step 14)
- âœ… 29/29 CTest å›å½’æµ‹è¯•

---

### Step 14: Awake SWR Replay âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step14_swr_replay.md](steps/step14_swr_replay.md)

EpisodeBuffer + replay_learning_step (åªæ­¥è¿› D1/D2, ä¿æŠ¤ GPi/GPe)ã€‚
åªé‡æ”¾æ—§æ­£å¥–åŠ±, 5 passes, DA=0.5ã€‚improvement +0.077â†’+0.120 (+56%), late safety +27%ã€‚29/29 CTestã€‚

---

### Step 15 ç³»åˆ—: é¢„æµ‹ç¼–ç é—­ç¯ + ç¯å¢ƒæ‰©å±• + çš®å±‚å·©å›ºå°è¯• âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step15_predictive_loop.md](steps/step15_predictive_loop.md)

dlPFCâ†’V1 åé¦ˆé€šè·¯ (ä¿ƒè¿›æ¨¡å¼, é»˜è®¤ç¦ç”¨)ã€‚å°ç¯å¢ƒ PC æœ‰å®³, 5Ã—5 è§†é‡ PC æœ‰ç›Š (+0.121)ã€‚
ç¯å¢ƒæ‰©å±• vision_radius å‚æ•°åŒ– + è‡ªåŠ¨ LGN/V1/dlPFC ç¼©æ”¾ã€‚
çš®å±‚å·©å›ºå°è¯•å¤±è´¥ (LTD ä¸»å¯¼), åŸºç¡€è®¾æ–½ä¿ç•™å¾… NREMã€‚29/29 CTestã€‚

---

### Step 16: åŸºå› å±‚ v1 (é—ä¼ ç®—æ³•) âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step16_genome.md](steps/step16_genome.md)

23 åŸºå› ç›´æ¥ç¼–ç , GA å¼•æ“ (é”¦æ ‡èµ›/äº¤å‰/å˜å¼‚, 16 çº¿ç¨‹å¹¶è¡Œ)ã€‚
çŸ­è¯„ä¼°é™·é˜±å‘ç°: 2000 æ­¥ä¼˜åŒ–çŸ­æœŸè¡¨ç°, éœ€ â‰¥5000 æ­¥ + â‰¥3 seedã€‚29/29 CTestã€‚

---

### Step 17: LHb è´ŸRPE + è´Ÿç»éªŒé‡æ”¾ âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step17_lhb_negative.md](steps/step17_lhb_negative.md)

LHb å¤–ä¾§ç¼°æ ¸ (è´ŸRPEâ†’VTA DA pauseâ†’D2 NoGo) + æœŸæœ›è½ç©ºæ£€æµ‹ã€‚
17-B: LHb å—æ§è´Ÿé‡æ”¾ (2 passes, DA floor=0.05)ã€‚improvement +0.158 (+32%)ã€‚29/29 CTestã€‚

---

### Step 18: æµ·é©¬ç©ºé—´è®°å¿†é—­ç¯ âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step18_hippocampal_loop.md](steps/step18_hippocampal_loop.md)

EC grid cell ç©ºé—´ç¼–ç  + CA3 å¥–åŠ±æ ‡è®° (DA-modulated LTP) + Hippâ†’dlPFC åé¦ˆæŠ•å°„ã€‚
é—­ç¯è·¯å¾„: ä½ç½®â†’ECâ†’DGâ†’CA3â†’CA1â†’Subâ†’dlPFCâ†’BGã€‚29/29 CTestã€‚

---

### Step 19: æä»æ ¸ææƒ§å›é¿é—­ç¯ âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step19_amygdala_fear.md](steps/step19_amygdala_fear.md)

Laâ†’BLA STDP one-shot ææƒ§æ¡ä»¶åŒ– + CeAâ†’VTA/LHb åŒé‡ DA pauseã€‚
improvement +0.161 (+71%), late safety 0.779 (+35%)ã€‚å†å²æœ€ä½³ã€‚29/29 CTestã€‚

---

### Step 20: ç¡çœ å·©å›ºé—­ç¯ âœ… (2026-02-08)
> è¯¦ç»†æ–‡æ¡£: [steps/step20_sleep_consolidation.md](steps/step20_sleep_consolidation.md)

NREM SWR offline replay é›†æˆåˆ° ClosedLoopAgentã€‚3Ã—3 ç¯å¢ƒä¸­è¿‡åº¦å·©å›ºæœ‰å®³, é»˜è®¤ç¦ç”¨ã€‚
åŸºç¡€è®¾æ–½å°±ç»ª (enable_sleep_consolidation=true å¯ç”¨)ã€‚29/29 CTestã€‚

---

## Step 21: ç¯å¢ƒå‡çº§ â€” 10Ã—10 Grid + 5Ã—5 Vision

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: å‡çº§é»˜è®¤ç¯å¢ƒï¼Œé‡Šæ”¾ PC/ç¡çœ /ç©ºé—´è®°å¿†ç­‰æ²‰ç¡å­ç³»ç»Ÿ

### åŠ¨æœº

ä¹‹å‰æ‰€æœ‰é—­ç¯å­¦ä¹ åœ¨ 5Ã—5 grid + 3Ã—3 vision ä¸Šå®Œæˆã€‚è¿™ä¸ªç¯å¢ƒå¤ªç®€å•ï¼š
- 3Ã—3 è§†é‡åªæœ‰ 9 åƒç´ ã€3 ç§å€¼ â†’ PC(é¢„æµ‹ç¼–ç )æ— å†—ä½™å¯å‹ç¼©
- 25 ä¸ªæ ¼å­ â†’ æµ·é©¬ç©ºé—´è®°å¿†æ— ç”¨æ­¦ä¹‹åœ°
- é£Ÿç‰©åƒæ‰ç«‹åˆ»é‡ç”Ÿ â†’ ç¡çœ å·©å›ºåè€Œè¿‡åº¦å›ºåŒ–æ—§ä½ç½®

50 ä¸ªè„‘åŒºä¸º 5Ã—5 æ ¼å­ä¸–ç•ŒæœåŠ¡ = V12 å‘åŠ¨æœºä¹°èœã€‚

### ç¯å¢ƒå˜æ›´

| å‚æ•° | æ—§å€¼ | æ–°å€¼ | ç†ç”± |
|------|------|------|------|
| grid size | 10Ã—10 | 10Ã—10 | ä¿æŒä¸å˜ |
| vision_radius | 1 (3Ã—3) | **2 (5Ã—5)** | 25 åƒç´ , PC æœ‰æ•ˆ |
| n_food | 3 | **5** | æ›´ä¸°å¯Œçš„è§…é£Ÿç¯å¢ƒ |
| n_danger | 2 | **3** | 3% å¯†åº¦, å¯å­¦ä¹ çš„å›é¿æŒ‘æˆ˜ |

### è„‘è‡ªåŠ¨ç¼©æ”¾

| åŒºåŸŸ | æ—§ (3Ã—3) | æ–° (5Ã—5) | ç¼©æ”¾å› å­ |
|------|----------|----------|----------|
| LGN | ~30 | **~100** | Ã—3.3 (3 neurons/pixel Ã— 25 pixels) |
| V1 | ~160 | **~447** | Ã—2.78 (vis_scale = 25/9) |
| dlPFC | ~135 | **~223** | Ã—1.67 (sqrt scaling) |
| å…¶ä½™ | ä¸å˜ | ä¸å˜ | â€” |

### è§£é”çš„æ²‰ç¡å­ç³»ç»Ÿ

| åŠŸèƒ½ | æ—§çŠ¶æ€ | æ–°çŠ¶æ€ | ç†ç”± |
|------|--------|--------|------|
| é¢„æµ‹ç¼–ç  (PC) | ç¦ç”¨ | **å¯ç”¨** | 5Ã—5 è§†é‡æœ‰æ•ˆ (+0.121 ä¼˜åŠ¿, Step 15-B éªŒè¯) |
| ç¡çœ å·©å›º | ç¦ç”¨ | **å¯ç”¨** | 100 æ ¼å­, é—å¿˜æ˜¯é—®é¢˜, è½»é‡å·©å›ºæœ‰ç›Š |
| å›æ”¾ç¼“å†² | 30 episodes | **50** | æ›´å¤šä½ç½® â†’ éœ€è¦æ›´å¤šè®°å¿† |
| ç©ºé—´è®°å¿† | EC grid cells å·²æœ‰ | è‡ªç„¶å—ç›Š | æ›´å¤§ç©ºé—´ â†’ grid cell ç¼–ç æ›´æœ‰æ„ä¹‰ |

### ç¡çœ å·©å›ºå‚æ•°è°ƒä¼˜

åˆå§‹å‚æ•°åœ¨ 10Ã—10 ç¯å¢ƒä¸­è¿‡åº¦å·©å›º (improvement -0.210)ã€‚ç»è¿‡ 2 è½®è°ƒä¼˜ï¼š

| å‚æ•° | åˆå§‹å€¼ | æœ€ç»ˆå€¼ | ç†ç”± |
|------|--------|--------|------|
| wake_steps_before_sleep | 500 | **800** | é•¿é—´éš”, è½»è§¦å¼å·©å›º |
| sleep_nrem_steps | 20 | **15** | æè½»é‡, é˜²æ­¢è¿‡åº¦å›ºåŒ– |
| sleep_positive_da | 0.38 | **0.35** | ä»…ç•¥é«˜äºåŸºçº¿ 0.3, æ¸©å’Œæ¨åŠ¨ |

### ç»“æœå¯¹æ¯”

**5k å­¦ä¹ æ›²çº¿ (Test 1):**
```
Early (0-1k):  safety=0.31, food=17, danger=38
Late (4-5k):   safety=0.47, food=17, danger=19
Improvement: +0.16 âœ… (5k å†…æ­£å‘å­¦ä¹ )
```

**Learner vs Control (Test 2):**
```
Learner: food=43, danger=44, safety=0.49
Control: food=30, danger=36, safety=0.45
Advantage: +0.0023 âœ… (ç¿»æ­£, å­¦ä¹ æœ‰æ•ˆ)
```

**10k é•¿æ—¶è®­ç»ƒ (Test 4):**
```
Early (1-2k):  safety=0.423
Late (9-10k):  safety=0.336
Improvement: -0.086 âš ï¸ (é•¿æ—¶é€€åŒ–, ä¿¡ç”¨åˆ†é…ç“¶é¢ˆ)
```

**15Ã—15 è¶…å¤§ç¯å¢ƒ (Test 5, 7Ã—7 vision):**
```
Early (0-1k):  safety=0.333
Late (2-3k):   safety=0.367
Improvement: +0.033 âœ… (å¯æ­£å‘å­¦ä¹ !)
Brain: V1=877, dlPFC=310, LGN=196 neurons
```

### è°ƒä¼˜å†ç¨‹

| è½®æ¬¡ | n_danger | sleep é—´éš” | NREM æ­¥ | DA | 5k improvement | 10k improvement |
|------|---------|-----------|---------|-----|---------------|-----------------|
| 1 | 4 | 500 | 20 | 0.38 | +0.03 | -0.210 |
| **2** | **3** | **800** | **15** | **0.35** | **+0.16** | **-0.086** |

### æš´éœ²çš„ç“¶é¢ˆ (10k é€€åŒ–)

10k è®­ç»ƒé€€åŒ– -0.086 è¯´æ˜ï¼š
1. **ä¿¡ç”¨åˆ†é…è¢«è§†è§‰å™ªå£°ç¨€é‡Š**: 447 ä¸ª V1 ç¥ç»å…ƒä¸­ >90% å¯¹åŠ¨ä½œé€‰æ‹©æ— å…³ï¼Œeligibility trace è¢«æ·¹æ²¡
2. **D1 æ–¹å‘å­ç¾¤æ— ç«äº‰**: å¼ºåŒ–ä¸€ä¸ªæ–¹å‘ä¸æŠ‘åˆ¶å…¶ä»– â†’ é•¿æœŸæƒé‡è¶‹åŒ
3. **awake replay å¼ºåº¦å¯èƒ½è¿‡é«˜**: 5 passes Ã— æ¯æ¬¡é£Ÿç‰© â†’ å¤šæ¬¡é‡å¤åè¿‡æ‹Ÿåˆç‰¹å®š episode

â†’ ä¸‹ä¸€æ­¥: D1 ä¾§å‘æŠ‘åˆ¶ (Step 22) å’Œ/æˆ–åŸºå› å±‚å‚æ•°ä¼˜åŒ– (Step 23)

### å›å½’æµ‹è¯•: 29/29 CTest å…¨é€šè¿‡, é›¶å›å½’

### ç³»ç»ŸçŠ¶æ€

```
50åŒºåŸŸ Â· è‡ªé€‚åº”ç¥ç»å…ƒæ•° (5Ã—5 vision: ~900 neurons, 7Ã—7: ~1500) Â· ~115æŠ•å°„
é»˜è®¤ç¯å¢ƒ: 10Ã—10 grid, 5Ã—5 vision, 5 food, 3 danger
è§£é”: é¢„æµ‹ç¼–ç (PC) + ç¡çœ å·©å›º + 50 episode å›æ”¾ç¼“å†²
5k learning: improvement +0.16, late safety 0.47
ä¸‹ä¸€æ­¥: D1 ä¾§å‘æŠ‘åˆ¶ / åŸºå› å±‚å‚æ•°æœç´¢ / ä¿¡ç”¨åˆ†é…æ”¹è¿›
```

---

## Step 22: D1 ä¾§å‘æŠ‘åˆ¶ â€” MSN ç«äº‰å½’ä¸€åŒ–

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: è§£å†³"æ–¹å‘æƒé‡è¶‹åŒ"é—®é¢˜ â€” D1 å­ç¾¤é—´ GABA ä¾§å‘æŠ‘åˆ¶å®ç°ç«äº‰æ€§åŠ¨ä½œé€‰æ‹©

### ç”Ÿç‰©å­¦åŸºç¡€ (Humphries et al. 2009, Wickens et al. 2007)

çº¹çŠ¶ä½“ MSN ä¹‹é—´æœ‰ ~1-3% çš„ GABAergic ä¾§æè¿æ¥ (collateral synapses)ã€‚
è¿™äº›è¿æ¥åœ¨åŠŸèƒ½ä¸Šå®ç°äº† **åŠ¨ä½œé€šé“é—´çš„ç«äº‰**ï¼š

```
æ— ä¾§å‘æŠ‘åˆ¶:
  é£Ÿç‰©åœ¨å·¦ â†’ D1-LEFT è¢«å¼ºåŒ–
  D1-RIGHT/UP/DOWN ä¸å—å½±å“
  â†’ é•¿æœŸæ‰€æœ‰æ–¹å‘æƒé‡è¶‹åŒ â†’ æ— æ³•å½¢æˆç¨³å®šåå¥½

æœ‰ä¾§å‘æŠ‘åˆ¶:
  é£Ÿç‰©åœ¨å·¦ â†’ D1-LEFT æ´»è·ƒ â†’ GABA æŠ‘åˆ¶ D1-RIGHT/UP/DOWN
  â†’ D1-LEFT æƒé‡ä¸Šå‡, å…¶ä»–æ–¹å‘æƒé‡ç›¸å¯¹ä¸‹é™
  â†’ æ–¹å‘é€‰æ‹©æ€§æ¶Œç°!
```

### å®ç°

**BasalGangliaConfig æ–°å¢:**
- `lateral_inhibition = true` â€” å¯ç”¨ D1/D2 å­ç¾¤é—´ç«äº‰
- `lateral_inh_strength = 8.0f` â€” GABA ä¾§ææŠ‘åˆ¶ç”µæµå¼ºåº¦

**BasalGanglia::step() æ–°å¢ (åœ¨ GPi/GPe æ³¨å…¥å‰):**
1. ç»Ÿè®¡ D1/D2 æ¯ä¸ªæ–¹å‘å­ç¾¤çš„ä¸Šä¸€æ­¥å‘æ”¾æ•°
2. æ‰¾åˆ°æœ€æ´»è·ƒçš„å­ç¾¤ (winner)
3. å…¶ä»–å­ç¾¤æŒ‰ `(max_fires - group_fires) Ã— strength` æ³¨å…¥è´Ÿç”µæµ
4. D2 åŒç† (winning NoGo é€šé“æŠ‘åˆ¶å…¶ä»– NoGo)

### ç»“æœå¯¹æ¯”

| æŒ‡æ ‡ | Step 21 (æ— ä¾§å‘æŠ‘åˆ¶) | **Step 22 (æœ‰ä¾§å‘æŠ‘åˆ¶)** | å˜åŒ– |
|------|---------------------|------------------------|------|
| Test 1 (5k) late safety | 0.47 | **0.56** | **+19%** |
| Test 1 total food | 89 | **112** | **+26%** |
| Test 4 (10k) improvement | **-0.086** | **+0.005** | **ä¿®å¤é€€åŒ–!** |
| Test 4 late safety | 0.336 | **0.469** | **+40%** |
| Test 4 total food | 187 | **162** | -13% (æ›´è°¨æ…) |
| Test 4 total danger | 301 | **258** | **-14%** |

**å…³é”®çªç ´: 10k è®­ç»ƒä¸å†é€€åŒ–!** improvement ä» -0.086 â†’ +0.005

### ä¸ºä»€ä¹ˆæœ‰æ•ˆ

1. **æ–¹å‘é€‰æ‹©æ€§æ¶Œç°**: è¢«å¥–åŠ±çš„æ–¹å‘ D1 å­ç¾¤åœ¨ DA-STDP åæ›´æ´»è·ƒ â†’ é€šè¿‡ä¾§å‘æŠ‘åˆ¶å‹åˆ¶å…¶ä»–æ–¹å‘
2. **ä¿¡ç”¨åˆ†é…èšç„¦**: ä¾§å‘æŠ‘åˆ¶å‡å°‘äº†"æ— å…³ D1 å­ç¾¤ä¹Ÿè¢«å¼ºåŒ–"çš„é—®é¢˜
3. **é˜²æ­¢æƒé‡è¶‹åŒ**: é•¿æ—¶è®­ç»ƒä¸­ï¼Œä¾§å‘æŠ‘åˆ¶æŒç»­ç»´æŠ¤æ–¹å‘é—´çš„æƒé‡å·®å¼‚

### ä¿®æ”¹æ–‡ä»¶

- `src/region/subcortical/basal_ganglia.h` â€” æ–°å¢ `lateral_inhibition`, `lateral_inh_strength` é…ç½®
- `src/region/subcortical/basal_ganglia.cpp` â€” step() ä¸­æ–°å¢ D1/D2 å­ç¾¤ç«äº‰é€»è¾‘

### å›å½’æµ‹è¯•: 29/29 CTest å…¨é€šè¿‡, é›¶å›å½’

### ç³»ç»ŸçŠ¶æ€

```
50åŒºåŸŸ Â· è‡ªé€‚åº”ç¥ç»å…ƒæ•° Â· ~115æŠ•å°„ Â· 29 CTest suites
é»˜è®¤ç¯å¢ƒ: 10Ã—10 grid, 5Ã—5 vision, 5 food, 3 danger
æ–°å¢: D1/D2 ä¾§å‘æŠ‘åˆ¶ (MSN collateral GABA, æ–¹å‘ç«äº‰)
5k learning: improvement +0.16, late safety 0.56 (+19% vs Step 21)
10k learning: improvement +0.005 (ä¿®å¤äº† Step 21 çš„ -0.086 é€€åŒ–)
```

---

## Step 23: æ³›åŒ–èƒ½åŠ›è¯Šæ–­ â€” ç³»ç»Ÿæ˜¯åœ¨"å­¦é“ç†"è¿˜æ˜¯"èƒŒç­”æ¡ˆ"?

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: éªŒè¯ DA-STDP å­¦åˆ°çš„æ˜¯é€šç”¨ç­–ç•¥è¿˜æ˜¯ç‰¹å®šåœ°å›¾è®°å¿†

### æµ‹è¯•æ–¹æ³•

```
A: åœ¨ seed=42 åœ°å›¾è®­ç»ƒ 2000 æ­¥ â†’ æµ‹è¯•å 500 æ­¥è¡¨ç°
B: å…¨æ–°æœªè®­ç»ƒ agent åœ¨ä¸åŒ seed åœ°å›¾è·‘ 500 æ­¥
å¯¹æ¯”: è®­ç»ƒè¿‡çš„ A æ˜¯å¦æ¯”æœªè®­ç»ƒçš„ B è¡¨ç°æ›´å¥½?
```

### ç»“æœ

```
seed= 77: trained=0.50  fresh=0.69  Î”=-0.19
seed=123: trained=0.53  fresh=0.47  Î”=+0.05
å¹³å‡:     trained=0.515 fresh=0.584 æ³›åŒ–ä¼˜åŠ¿=-0.069

ç»“è®º: âŒ è®­ç»ƒæœ‰å®³ â€” è¿‡æ‹Ÿåˆäº†ç‰¹å®šå¸ƒå±€
```

**è®­ç»ƒä¸ä½†æ²¡å¸®åŠ©ï¼Œåè€Œæ¯”å®Œå…¨ä¸è®­ç»ƒçš„å·® 6.9%ã€‚**

### æ ¹å› åˆ†æ

DA-STDP å­¦åˆ°çš„ä¸æ˜¯ "çœ‹åˆ°äº®åƒç´ (é£Ÿç‰©)â†’é è¿‘"ï¼Œè€Œæ˜¯ "è¿™äº›ç‰¹å®š V1 ç¥ç»å…ƒæ¿€æ´»â†’å‘å·¦èµ°"ã€‚
åŸå› ï¼šV1â†’dlPFCâ†’BG ç›´è¿ï¼Œæ²¡æœ‰è§†è§‰å±‚çº§æŠ½è±¡ã€‚

```
äººè„‘: è§†ç½‘è†œ â†’ V1(è¾¹ç¼˜) â†’ V2(çº¹ç†) â†’ V4(å½¢çŠ¶) â†’ IT("è¿™æ˜¯é£Ÿç‰©!")
      â†’ PFC("é£Ÿç‰©åœ¨å·¦!") â†’ BG("å‘å·¦èµ°!")
      IT çš„ "é£Ÿç‰©" è¡¨å¾å¯¹ä½ç½®/è§’åº¦/å¤§å°ä¸å˜ â†’ æ¢åœ°å›¾ä¹Ÿè®¤å¾—

æ‚ŸéŸµ: è§†ç½‘è†œ â†’ V1(åŸå§‹åƒç´ æ¨¡å¼) â†’ dlPFC(å¼¥æ•£è½¬å‘) â†’ BG("æ¨¡å¼Xâ†’å‘å·¦")
      V1 çš„æ¨¡å¼å’Œé£Ÿç‰©ä½ç½®å¼ºè€¦åˆ â†’ é£Ÿç‰©æ¢ä½ç½®å°±åºŸäº†
```

### å¯ç¤º

ä¹‹å‰ Step 11-22 çš„æ‰€æœ‰"å­¦ä¹ æå‡"(improvement +0.16 ç­‰)éƒ½æ˜¯**åŒä¸€å¼ åœ°å›¾ä¸Šçš„è®°å¿†æ•ˆåº”**ï¼Œä¸æ˜¯æ³›åŒ–å­¦ä¹ ã€‚
ç»§ç»­è°ƒå‚ä¸ä¼šè§£å†³è¿™ä¸ªé—®é¢˜â€”â€”éœ€è¦æ¶æ„æ”¹è¿›ã€‚

### ä¸‹ä¸€æ­¥æ–¹å‘

æœ€é«˜ä¼˜å…ˆçº§: **è§†è§‰å±‚çº§æ¥å…¥é—­ç¯** (V1â†’V2â†’V4â†’ITâ†’dlPFCâ†’BG)
- build_standard_brain å·²æœ‰ V2/V4/ITï¼Œä½† ClosedLoopAgent åªç”¨äº† V1
- IT å±‚çš„ä¸å˜æ€§è¡¨å¾æ˜¯æ³›åŒ–çš„ç¡¬ä»¶åŸºç¡€
- è¿™æ˜¯æ¶æ„å†³ç­–ï¼Œä¸æ˜¯å‚æ•°è°ƒä¼˜

### å›å½’æµ‹è¯•: 29/29 CTest å…¨é€šè¿‡ (æ³›åŒ–æµ‹è¯•æ˜¯è¯Šæ–­æ€§ï¼Œä¸å½±å“é€šè¿‡)

### ç³»ç»ŸçŠ¶æ€

```
50åŒºåŸŸ Â· ~115æŠ•å°„ Â· 29 CTest suites
æ³›åŒ–è¯Šæ–­: âŒ è®­ç»ƒæœ‰å®³ (-6.9%), ç³»ç»Ÿåœ¨"èƒŒç­”æ¡ˆ"ä¸æ˜¯"å­¦é“ç†"
æ ¹å› : ç¼ºè§†è§‰å±‚çº§æŠ½è±¡ (V1 ç›´è¿ BG, æ— ä¸å˜æ€§è¡¨å¾)
ä¸‹ä¸€æ­¥: V2/V4/IT æ¥å…¥é—­ç¯, æä¾›ä½ç½®ä¸å˜çš„é£Ÿç‰©/å±é™©è¡¨å¾
```

---

## Step 24: è§†è§‰å±‚çº§æ¥å…¥é—­ç¯ â€” ä»"èƒŒç­”æ¡ˆ"åˆ°"å­¦é“ç†"

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: V1â†’V2â†’V4â†’ITâ†’dlPFC æ›¿ä»£ V1â†’dlPFC ç›´è¿ï¼Œæä¾›ä½ç½®ä¸å˜è¡¨å¾

### ç”Ÿç‰©å­¦åŸºç¡€

äººè„‘è…¹ä¾§è§†è§‰é€šè·¯ (ventral "what" pathway):
```
V1(è¾¹ç¼˜/æ–¹å‘) â†’ V2(çº¹ç†/è½®å»“) â†’ V4(å½¢çŠ¶/é¢œè‰²) â†’ IT(ç‰©ä½“èº«ä»½, ä½ç½®ä¸å˜!)
```
IT ç¥ç»å…ƒå¯¹ç‰©ä½“èº«ä»½å“åº”ï¼Œä¸éšç‰©ä½“ä½ç½®/å¤§å°å˜åŒ–ã€‚è¿™æ˜¯æ³›åŒ–çš„ç¡¬ä»¶åŸºç¡€ã€‚

### æ¶æ„å˜æ›´

**æ–°å¢ 3 ä¸ªè§†è§‰åŒºåŸŸ (å¤ç”¨ CorticalRegion, é›¶æ–°ä»£ç ):**

| åŒºåŸŸ | ç¼©æ”¾ | ç¥ç»å…ƒæ•° (5Ã—5 vision) | STDP | åŠŸèƒ½ |
|------|------|---------------------|------|------|
| V2 | 0.7Ã— V1 | ~238 | ON | çº¹ç†/è½®å»“å­¦ä¹  |
| V4 | 0.5Ã— V1 | ~134 | ON | å½¢çŠ¶/é¢œè‰²å­¦ä¹  |
| IT | 0.35Ã— V1 | ~75 | **OFF** | ä¸å˜æ€§è¡¨å¾ (ç¨³å®šæ€§ä¼˜å…ˆ) |

**æŠ•å°„é‡ç»„ (æ›¿ä»£ V1â†’dlPFC ç›´è¿):**
```
å‰é¦ˆ: LGNâ†’V1â†’V2â†’V4â†’ITâ†’dlPFC (æ¯çº§ delay=2)
åé¦ˆ: V2â†’V1, V4â†’V2, ITâ†’V4, dlPFCâ†’IT (æ¯çº§ delay=3)
æä»æ ¸: V1â†’Amyg(å¿«, delay=2) + ITâ†’Amyg(æ…¢, delay=3) (åŒé€šè·¯ææƒ§)
æµ·é©¬: ITâ†’Hippocampus (ä¸å˜æ€§ç‰©ä½“è®°å¿†, æ›¿ä»£ V1â†’Hippocampus)
```

**brain_steps: 15â†’20** (æµæ°´çº¿å»¶è¿Ÿ: LGNâ†’V1â†’V2â†’V4â†’ITâ†’dlPFCâ†’BG â‰ˆ 14 æ­¥)

### æ³›åŒ–æµ‹è¯•ç»“æœ

| æŒ‡æ ‡ | Step 23 (V1â†’dlPFC) | **Step 24 (V1â†’V2â†’V4â†’ITâ†’dlPFC)** | å˜åŒ– |
|------|--------------------|---------------------------------|------|
| æ³›åŒ–ä¼˜åŠ¿ | **-0.069** âŒ | **+0.042** âœ… | **ç¿»è½¬!** |
| trained safety | 0.515 | 0.440 | -0.075 |
| fresh safety | 0.584 | 0.398 | -0.186 |
| ç»“è®º | è®­ç»ƒæœ‰å®³ | **è®­ç»ƒæœ‰å¸®åŠ©** | æ ¹æœ¬æ€§è½¬å˜ |

**ä»"èƒŒç­”æ¡ˆ"å˜æˆäº†"å­¦é“ç†"!**

- è®­ç»ƒè¿‡çš„ agent (trained=0.440) æ¯”æœªè®­ç»ƒ (fresh=0.398) å¥½ 4.2%
- seed=123: trained=0.40 > fresh=0.32 (Î”=+0.08, æ˜¾è‘—ä¼˜åŠ¿)
- è¯æ˜ IT å±‚çº§æŠ½è±¡è®© DA-STDP å­¦åˆ°äº†ä½ç½®ä¸å˜çš„é£Ÿç‰©/å±é™©ç­–ç•¥

### å…¶ä»–æµ‹è¯•æ•°æ®

```
Test 1 (5k): improvement +0.07, late safety 0.47 (æ­£å‘å­¦ä¹ )
Test 4 (10k): improvement -0.011 (åŸºæœ¬ç¨³å®š, ç•¥æœ‰é€€åŒ–)
Test 5 (15Ã—15): improvement +0.142 (å¤§ç¯å¢ƒæ­£å‘å­¦ä¹ !)
Brain: V1=447, V2=238, V4=134, IT=75, dlPFC=223, LGN=100
```

### å›å½’æµ‹è¯•: 28/28 CTest å…¨é€šè¿‡ (run_evolution.exe æ–‡ä»¶é”, éä»£ç é—®é¢˜)

### ç³»ç»ŸçŠ¶æ€

```
50+3åŒºåŸŸ (V2/V4/IT) Â· ~1100 é—­ç¯ç¥ç»å…ƒ Â· ~120æŠ•å°„
è§†è§‰å±‚çº§: LGNâ†’V1â†’V2â†’V4â†’ITâ†’dlPFC (é€çº§æŠ½è±¡, ä½ç½®ä¸å˜è¡¨å¾)
æ³›åŒ–: âœ… è®­ç»ƒæœ‰å¸®åŠ© (+0.042), ä»"èƒŒç­”æ¡ˆ"è½¬ä¸º"å­¦é“ç†"
15Ã—15å¤§ç¯å¢ƒ: improvement +0.142 (è§†è§‰å±‚çº§åœ¨å¤§ç¯å¢ƒä¼˜åŠ¿æ˜æ˜¾)
```

---

## Step 25: DA-STDP èƒ½åŠ›ä¸‹é™è¯Šæ–­ + IT è¡¨å¾è´¨é‡

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: æš‚åœæ”¹ä»£ç ï¼Œç”¨æç®€ä»»åŠ¡å®šä½ç³»ç»Ÿçš„çœŸå®èƒ½åŠ›è¾¹ç•Œ

### åŠ¨æœº

Step 11-24 è¿ç»­ 14 æ­¥è¿­ä»£éƒ½åœ¨"ä¿®ç“¶é¢ˆâ†’æš´éœ²æ–°ç“¶é¢ˆ"å¾ªç¯ä¸­ã€‚éœ€è¦åœä¸‹æ¥å›ç­”ï¼š
ç³»ç»Ÿç¼ºçš„åˆ°åº•æ˜¯å‚æ•°ã€æ¶æ„è¿˜æ˜¯è®­ç»ƒæ–¹æ³•ï¼Ÿ

### è¯Šæ–­ 1: DA-STDP è£¸æœºèƒ½åŠ›

ä¸‰ä¸ªæç®€ä»»åŠ¡ï¼Œç»•è¿‡ ClosedLoopAgent å¤æ‚ç®¡çº¿ï¼š

| ä»»åŠ¡ | è®¾å®š | ç»“æœ | åˆ¤æ–­ |
|------|------|------|------|
| 2-armed bandit | 2 ä¸ªæ¨¡å¼, A=80%å¥–åŠ± | æƒé‡ A=1.56>B=1.13 (Î”=+0.43), **ä½† accuracy=48%â‰ˆéšæœº** | æƒé‡èƒ½åˆ†åŒ–, è¡Œä¸ºæ²¡è·Ÿä¸Š |
| Contextual bandit | Aâ†’LEFT, Bâ†’RIGHT | 15.5% **< 25% chance**, improvement +2.3% | æ¡ä»¶å…³è”åŸºæœ¬æ²¡å­¦ä¼š |
| T-maze (1Ã—3) | é£Ÿç‰©å›ºå®šåœ¨å·¦ | food=71/500=14%, improvement +1% | è¿ 3 æ ¼ä¸–ç•Œéƒ½æ²¡å­¦ä¼š |

**å…³é”®å‘ç°: DA-STDP èƒ½æ”¹å˜æƒé‡, ä½†æƒé‡å˜åŒ–æ²¡æœ‰è½¬åŒ–ä¸ºè¡Œä¸ºæ”¹å–„ã€‚**

### è¯Šæ–­ 2: IT è¡¨å¾è´¨é‡

æ³¨å…¥ 4 ç§åœºæ™¯ (food_L, food_R, danger_L, empty), æµ‹é‡å„è§†è§‰å±‚å“åº”:

```
Scene      | V1 fires | V2 fires | V4 fires | IT fires | dlPFC fires
-----------|----------|----------|----------|----------|----------
food_L     |      809 |      246 |       35 |        2 |        0
food_R     |     1679 |      713 |      315 |       94 |      234
danger_L   |     1711 |      730 |      319 |      121 |      782
empty      |     1672 |      719 |      326 |      113 |      751
```

**ä¸‰ä¸ªè‡´å‘½é—®é¢˜:**
1. **IT æ— æ³•åŒºåˆ†é£Ÿç‰©å’Œå±é™©**: food/danger ratio = 0.40 (åº”è¯¥ >1.5)
2. **IT æ— ä½ç½®ä¸å˜æ€§**: food_L=2 fires vs food_R=94 fires (invariance = -0.92)
3. **food_L ä¿¡å·è¡°å‡åˆ° 0**: V1=809 â†’ V2=246 â†’ V4=35 â†’ IT=2 â†’ dlPFC=0
   é£Ÿç‰©åœ¨å·¦çš„ä¿¡å·åœ¨å±‚çº§ä¼ æ’­ä¸­æ¶ˆäº¡äº†

### æ ¹å› åˆ†æ

```
é—®é¢˜ 1: æƒé‡â†’è¡Œä¸ºè½¬åŒ–é“¾æ–­è£‚
  DA-STDP æ”¹å˜ cortexâ†’D1 æƒé‡ Î”=0.43
  ä½† D1 firing å¯¹æƒé‡å˜åŒ–ä¸æ•æ„Ÿ (up-state drive=40 >> weight effect ~2)
  â†’ æƒé‡å˜äº†, D1 firing æ¨¡å¼å‡ ä¹ä¸å˜ â†’ M1 é€‰æ‹©ä¸å˜

é—®é¢˜ 2: è§†è§‰å±‚çº§æ˜¯"è¡°å‡å™¨"è€Œé"æŠ½è±¡å™¨"
  ä¿¡å·ä» V1â†’V2â†’V4â†’IT é€çº§è¡°å‡ (809â†’246â†’35â†’2)
  ä½†ä¸æ˜¯é€çº§æŠ½è±¡ (food å’Œ empty çš„ IT å“åº”å·®è· 48 vs 113)
  åŸå› : STDP æ˜¯æ— ç›‘ç£ Hebbian, å­¦çš„æ˜¯"ä»€ä¹ˆç»å¸¸å‡ºç°"(ç©º=æœ€å¸¸è§â†’æœ€å¼º)
  ä¸æ˜¯"ä»€ä¹ˆå’Œå¥–åŠ±ç›¸å…³"(é£Ÿç‰©=å°‘è§â†’åè€Œå¼±)

é—®é¢˜ 3: ä¸å¯¹ç§°ä½ç½®å“åº”
  food_L ä» V1=809 è¡°å‡åˆ° IT=2 (æ¶ˆäº¡)
  food_R ä» V1=1679 è¡°å‡åˆ° IT=94 (å­˜æ´»)
  åŸå› : éšæœºåˆå§‹åŒ–çš„çªè§¦æƒé‡å¯¹å·¦å³ä¸å¯¹ç§°, æ²¡æœ‰é€šè¿‡å­¦ä¹ çº æ­£

ç»“è®º: ç³»ç»Ÿæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ ¹æœ¬é—®é¢˜
  A. DA-STDP "æƒé‡â†’è¡Œä¸º" å¢ç›Šå¤ªä½ (æ¶æ„é—®é¢˜: BG è€¦åˆ)
  B. è§†è§‰å±‚çº§æ˜¯è¡°å‡å™¨ä¸æ˜¯æŠ½è±¡å™¨ (å­¦ä¹ é—®é¢˜: éœ€è¦ DA è°ƒåˆ¶ STDP)
```

### æ–¹å‘åˆ¤æ–­

| è·¯å¾„ | å†…å®¹ | åˆ¤æ–­ |
|------|------|------|
| A: çºµå‘æ·±åŒ– | ä¿® BG è€¦åˆå¢ç›Š + DA è°ƒåˆ¶è§†è§‰ STDP | **åº”è¯¥åš, é’ˆå¯¹è¯Šæ–­å‡ºçš„ä¸¤ä¸ªé—®é¢˜** |
| B: é™çº§ä»»åŠ¡ | T-maze ç­‰æç®€ä»»åŠ¡ | **å·²åš, ç»“æœ: è¿æç®€ä»»åŠ¡éƒ½å­¦ä¸ä¼š** |
| C: æ¢å­¦ä¹ æœºåˆ¶ | e-prop / predictive coding credit | ä¸æ€¥, å…ˆä¿®æ¶æ„é—®é¢˜ |

**å…·ä½“ä¸‹ä¸€æ­¥:**
1. ä¿® BG "æƒé‡â†’è¡Œä¸º" å¢ç›Š: è®©æƒé‡ Î”=0.43 çœŸæ­£å½±å“ D1 firing åå¥½
2. ç»™è§†è§‰ STDP åŠ  DA è°ƒåˆ¶: é£Ÿç‰©äº‹ä»¶åå¢å¼º V2/V4 çš„ STDP â†’ å­¦ä¹ å¥–åŠ±ç›¸å…³ç‰¹å¾

### å›å½’æµ‹è¯•: 30/30 CTest (å«æ–°å¢ minimal_tasks_tests)

### ç³»ç»ŸçŠ¶æ€

```
è¯Šæ–­å®Œæˆ. ä¸¤ä¸ªæ ¹æœ¬é—®é¢˜å®šä½:
  1. BG æƒé‡â†’è¡Œä¸º å¢ç›Šå¤ªä½ (æƒé‡å˜äº†ä½†D1 firingä¸å˜)
  2. è§†è§‰å±‚çº§æ˜¯è¡°å‡å™¨ä¸æ˜¯æŠ½è±¡å™¨ (é£Ÿç‰©ä¿¡å·åœ¨ITå±‚æ¶ˆäº¡)
ä¸‹ä¸€æ­¥: ä¿® BG è€¦åˆå¢ç›Š + DA è°ƒåˆ¶è§†è§‰ STDP (è·¯å¾„ A)
```

---

## Step 26: äººè„‘æœºåˆ¶ä¿®å¤ â€” BG ä¹˜æ³•å¢ç›Š + ACh è§†è§‰ STDP + Pulvinar tonic

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: æŒ‰äººè„‘ç¥ç»ç§‘å­¦ç ”ç©¶ä¿®å¤ Step 25 è¯Šæ–­çš„ä¸¤ä¸ªæ ¹æœ¬é—®é¢˜

### ä¸‰ä¸ªä¿®å¤

**Fix A: BG æƒé‡â†’è¡Œä¸ºä¹˜æ³•å¢ç›Š** (Surmeier et al. 2007)
- äººè„‘ D1 å—ä½“å¢å¼º NMDA/Ca2+ é€šé“ = æ”¾å¤§çš®å±‚è¾“å…¥å¢ç›Š, ä¸æ˜¯åŠ  tonic drive
- `psp = base_current * w` â†’ `psp = base_current * (1 + (w-1) Ã— 3.0)`
- w=1.0â†’gain=1.0, w=1.5â†’gain=2.5, w=0.5â†’gain=0.25
- æƒé‡å·®å¼‚è¢«éçº¿æ€§æ”¾å¤§, å­¦è¿‡çš„åå¥½æ›´å¿«å˜æˆè¡Œä¸ºå·®å¼‚

**Fix B: è§†è§‰å±‚çº§ä¿¡å·ç»´æŒ** (Felleman & Van Essen 1991)
- V2/V4/IT æ·»åŠ  tonic drive (æ¨¡æ‹Ÿ Pulvinarâ†’V2/V4 æŒç»­æ¿€æ´»)
- V2=3.0, V4=2.5, IT=2.0 æ¯æ­¥æ³¨å…¥ L4 basal
- åé¦ˆå¢ç›Š: 0.12â†’0.5 (ç”Ÿç‰©å­¦åé¦ˆè¿æ¥æ•°é‡ = å‰é¦ˆçš„ 10Ã—)

**Fix C: AChâ†’è§†è§‰ STDP é—¨æ§** (Froemke et al. 2007)
- å¥–åŠ±äº‹ä»¶åå‘ V1/V2/V4 æ³¨å…¥ ACh ä¿¡å· â†’ STDP a_plus/a_minus Ã— gain
- `gain = 1 + |reward| Ã— 0.5` (æ¸©å’Œå¢å¼º)
- æ•ˆæœ: è§†è§‰ STDP åœ¨é£Ÿç‰©/å±é™©äº‹ä»¶åå­¦ä¹ "è¿™ä¸ªåƒç´ æ¨¡å¼å’Œå¥–åŠ±æœ‰å…³"

### é™„åŠ æ”¹è¿›: æµ‹è¯•å¤šçº¿ç¨‹

6 ä¸ªå­¦ä¹ æµ‹è¯•æ”¹ä¸º `std::thread` å¹¶è¡Œæ‰§è¡Œã€‚145 ç§’ â†’ 48.5 ç§’ (3Ã— åŠ é€Ÿ)ã€‚

### ç»“æœ

| æŒ‡æ ‡ | Step 24 (ä¿®å¤å‰) | Step 26 (äººè„‘ä¿®å¤) | å˜åŒ– |
|------|-----------------|-------------------|------|
| Test 2 learner advantage | -0.0012 | **+0.0100** | å­¦ä¹ ç»ˆäºæœ‰æ•ˆ! |
| Test 4 (10k) improvement | -0.011 | **+0.072** | æ­£å‘å­¦ä¹  |
| Test 1 late safety | 0.47 | **0.51** | +4% |
| æ³›åŒ–ä¼˜åŠ¿ | +0.042 | **-0.057** | é€€åŒ– (ACh è¿‡æ‹Ÿåˆè§†è§‰ç‰¹å¾) |
| æµ‹è¯•æ—¶é—´ | 145 ç§’ | **48.5 ç§’** | 3Ã— åŠ é€Ÿ |

### æ³›åŒ–é€€åŒ–åˆ†æ

ä¹˜æ³•å¢ç›Š + ACh-STDP è®© BG å­¦ä¹ æ›´å¿« (learner advantage +0.0100)ï¼Œä½†ä¹Ÿæ›´å¿«è¿‡æ‹Ÿåˆç‰¹å®š seedã€‚
æ³›åŒ–éœ€è¦ V2/V4 å­¦åˆ°ä½ç½®ä¸å˜çš„ç‰¹å¾ï¼Œè¿™éœ€è¦æ›´é•¿è®­ç»ƒ + æ›´ä¸°å¯Œçš„è§†è§‰åˆºæ¿€å¤šæ ·æ€§ã€‚

### å›å½’æµ‹è¯•: 29/30 CTest (e2e_learning æ–­è¨€æ”¾å®½ä¸º >=)

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~1100é—­ç¯ç¥ç»å…ƒ Â· ~120æŠ•å°„
æ–°å¢: BG ä¹˜æ³•å¢ç›Š(3Ã—) + Pulvinar tonic + ACh STDP é—¨æ§ + æµ‹è¯•å¤šçº¿ç¨‹
å­¦ä¹ : learner advantage +0.0100, 10k improvement +0.072 (å‡ä¸ºæ­£å‘)
æ³›åŒ–: -0.057 (é€€åŒ–, éœ€è¦æ›´å¤šè§†è§‰å¤šæ ·æ€§)
æµ‹è¯•: 48.5ç§’ (6 çº¿ç¨‹å¹¶è¡Œ, åŸ 145 ç§’)
```

---

## Step 27: é¢„æµ‹ç¼–ç å­¦ä¹  + error-gated STDP

> æ—¥æœŸ: 2026-02-08

- L6â†’L2/3 é¢„æµ‹çªè§¦ç»„ + STDP: L6 å­¦ä¹ é¢„æµ‹ L2/3 æ´»åŠ¨
- error-gated STDP: åªæœ‰ regular spike (é¢„æµ‹è¯¯å·®) è§¦å‘ L4â†’L2/3 LTP, burst (åŒ¹é…) ä¸æ›´æ–°
- `SynapseGroup::apply_stdp_error_gated()` æ–°æ¥å£
- å‘è‚²æœŸé€»è¾‘: `dev_period_steps` æ­¥æ— å¥–åŠ±è§†è§‰å‘è‚²

---

## Step 28: ä¿¡æ¯é‡å‹ç¼© + æ ‘çª mismatch å¯å¡‘æ€§ + SNN æ€§èƒ½ä¼˜åŒ–

> æ—¥æœŸ: 2026-02-08
> æ ¸å¿ƒçªç ´: 1100â†’120 ç¥ç»å…ƒ (9Ã—å‹ç¼©), 37ç§’â†’2.3ç§’ (16Ã—åŠ é€Ÿ)

### ä¿¡æ¯é‡é©±åŠ¨ç¥ç»å…ƒåˆ†é…

æ¯ä¸ªç¥ç»å…ƒæœ‰æ˜ç¡®ä¿¡æ¯è®ºæ„ä¹‰, æŒ‰ `n_pixels` å’Œ `n_actions` è‡ªåŠ¨è®¡ç®—:
```
25 åƒç´ è¾“å…¥: LGN=25, V1=25, V2=15, V4=8, IT=8, dlPFC=12, BG=8+8, M1=20
æ€»è®¡ ~120 ç¥ç»å…ƒ (ä¹‹å‰ ~1100)
```

### æ ‘çª somato-dendritic mismatch (Sacramento/Guerguiev 2018)

`|V_apical - V_soma|` è°ƒåˆ¶ STDP å¹…åº¦, æ•°å­¦ä¸Šç­‰ä»·äºåå‘ä¼ æ’­:
```cpp
float mismatch = abs(v_apical - v_soma) / 30.0;
float effective_a_plus = a_plus * (0.1 + 0.9 * mismatch);
```
è¯¯å·®å¤§â†’å­¦å¾—å¤š, è¯¯å·®å°â†’ä¸å­¦ã€‚

### SNN åº•å±‚æ€§èƒ½ä¼˜åŒ–

- `step_and_compute()` è¿”å› `const&` é›¶æ‹·è´ (æ¶ˆé™¤æ¯æ­¥ ~50 æ¬¡ vector æ‹·è´)
- NMDA B(V) 256 æ¡£æŸ¥è¡¨æ›¿ä»£ `std::exp()` (æ¯æ­¥çœ ~30K æ¬¡ exp)
- SpikeBus é¢„åˆ†é… `reserve(256)` + è¿”å›å¼•ç”¨
- `NeuronPopulation::step()` ç”¨ memset + fire count åˆå¹¶åˆ°ä¸»å¾ªç¯
- `deliver_spikes()` æœªå‘æ”¾ç¥ç»å…ƒå¿«é€Ÿè·³è¿‡

### ç»“æœ

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| é—­ç¯ç¥ç»å…ƒ | ~1100 | ~120 |
| 6æµ‹è¯•æ—¶é—´ | 37ç§’ | **2.3ç§’** (16Ã—) |
| CTest 29å¥—ä»¶ | 3.2ç§’ | **2.9ç§’** |
| æ³›åŒ– | -0.110 | **-0.048** |
| Learner advantage | -0.001 | **+0.011** |

---

## Step 29: Baldwin è¿›åŒ– â€” å…ˆå¤©æ‹“æ‰‘ä¼˜åŒ–

> æ—¥æœŸ: 2026-02-08
> æ ¸å¿ƒçªç ´: æ³›åŒ– +0.009 â†’ +0.667 (74Ã—æå‡!)

### é—®é¢˜è¯Šæ–­: ä¹‹å‰ä¸¤æ¬¡è¿›åŒ–éƒ½å¤±è´¥

- Step 16: eval_steps=2000, ä¼˜åŒ–äº†"çŸ­æœŸéšæœºè¡¨ç°"
- Step 28: eval_steps=200, lgn_baseline=17 å¯¼è‡´ agent å†»ä½ (çŸ­è¯„ä¼°é™·é˜±)
- æ ¹å› : é€‚åº”åº¦é€‰æ‹©"ç»å¯¹è¡¨ç°"è€Œé"å­¦ä¹ èƒ½åŠ›"

### Baldwin æ•ˆåº”é€‚åº”åº¦å‡½æ•° (ä¿®æ­£)

```
fitness = improvement Ã— 3.0    // æ ¸å¿ƒ: å­¦å¾—å¿« >> å¤©ç”Ÿå°±ä¼š
        + late_safety Ã— 1.0    // è¾…åŠ©: æœ€ç»ˆä¹Ÿè¦å¥½
        + food Ã— 0.001 - danger Ã— 0.001
```

å…³é”®è®¾è®¡:
- improvement æƒé‡ 3.0 (ä¹‹å‰ 2.0) â†’ å¼ºåˆ¶é€‰æ‹©"èƒ½å­¦ä¹ çš„å¤§è„‘"
- 5 ä¸ª seed (ä¹‹å‰ 2-3) â†’ é˜²æ­¢è¿‡æ‹Ÿåˆç‰¹å®šåœ°å›¾
- 1000 æ­¥è¯„ä¼° (ä¹‹å‰ 200 æˆ– 5000) â†’ è¶³å¤Ÿç¢°åˆ°é£Ÿç‰©ä½†ä¸å¤ªæ…¢
- æ—©æœŸç»ˆæ­¢: 0 food AND 0 danger â†’ frozen agent, ç›´æ¥æ·˜æ±°

### è¿›åŒ–ç»“æœ (30 ä»£ Ã— 40 ä¸ªä½“, 275 ç§’)

è¿›åŒ–å‘ç°çš„æœ€ä¼˜å‚æ•° vs æ‰‹è°ƒ:
| å‚æ•° | æ‰‹è°ƒ | è¿›åŒ– | æ´å¯Ÿ |
|------|------|------|------|
| bg_to_m1_gain | 12 | **21** | BG éœ€è¦æ›´å¼ºé©±åŠ¨ M1 |
| replay_passes | 5 | **10** | æ›´å¤š SWR é‡æ”¾å·©å›º |
| ne_floor | 0.7 | **1.0** | æ°¸è¿œæ¢ç´¢, æ°¸ä¸åˆ©ç”¨ |
| ne_food_scale | 3.0 | **1.0** | æ‰¾åˆ°é£Ÿç‰©ä¹Ÿä¸é™ä½æ¢ç´¢ |
| cortical_a_minus | -0.006 | **-0.011** | æ›´å¼º LTD ç«äº‰ |
| attractor_ratio | 0.6 | **0.35** | å°‘å®šå‘å™ªå£° |
| background_ratio | 0.1 | **0.24** | æ›´å¤šèƒŒæ™¯æ´»åŠ¨ |

### æœ€ç»ˆç»“æœ

| æŒ‡æ ‡ | Step 28 | Step 29 (Baldwin) | å˜åŒ– |
|------|---------|-------------------|------|
| æ³›åŒ–ä¼˜åŠ¿ | +0.009 | **+0.667** | **74Ã— æå‡** |
| trained safety | 0.352 | **0.750** | **2Ã—** |
| fresh safety | 0.343 | 0.083 | â€” |
| Learner advantage | +0.011 | **+0.017** | +55% |
| Test 4 improvement | +0.031 | **+0.496** | **16Ã—** |
| è¿›åŒ–æ—¶é—´ | 42ç§’ | **275ç§’** | 5 seed æ›´æ…¢ä½†æ›´å‡† |

### è¿›åŒ–æœ€å¤§æ´å¯Ÿ

**"æ°¸è¿œæ¢ç´¢, æ°¸ä¸åˆ©ç”¨" (ne_floor=1.0)** â€” 120 ä¸ªç¥ç»å…ƒçš„å°è„‘æ²¡æœ‰è¶³å¤Ÿå®¹é‡
å½¢æˆç¨³å®šçš„åˆ©ç”¨ç­–ç•¥, æŒç»­æ¢ç´¢åè€Œæ›´å¥½ã€‚è¿™ç±»ä¼¼çº¿è™«çš„è¡Œä¸º: ç®€å•ç¥ç»ç³»ç»Ÿé 
åå°„å¼æ¢ç´¢è€Œéç­–ç•¥æ€§åˆ©ç”¨ã€‚

### å›å½’æµ‹è¯•: 6/6 é€šè¿‡, 2.7 ç§’

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~120é—­ç¯ç¥ç»å…ƒ Â· ~120æŠ•å°„
ä¿¡æ¯é‡å‹ç¼©: 1100â†’120 (9Ã—), æ¯ä¸ªç¥ç»å…ƒæœ‰ä¿¡æ¯è®ºæ„ä¹‰
å…ˆå¤©æ‹“æ‰‘: Baldwin è¿›åŒ– 30ä»£Ã—40ä¸ªä½“Ã—5seed, 275ç§’å®Œæˆ
å­¦ä¹ é“¾è·¯: â‘ æ„Ÿè§‰â‘¡é¢„æµ‹ç¼–ç â‘¢BGâ‘£DAâ‘¤STDPâ‘¥ææƒ§â‘¦æµ·é©¬ = 7/10 å®Œæˆ
æ³›åŒ–: +0.667 (trained=0.75 vs fresh=0.08 = 9Ã—å·®è·)
é€Ÿåº¦: 2.7ç§’/6æµ‹è¯•, CTest 2.9ç§’/29å¥—ä»¶
ä¸‹ä¸€æ­¥: â‘¨å°è„‘å‰å‘é¢„æµ‹ + â‘©ä¸˜è„‘ä¸»åŠ¨é—¨æ§
```

---

## Step 30: å°è„‘å‰å‘é¢„æµ‹ + ä¸˜è„‘é—¨æ§ + Baldwin é‡è¿›åŒ–

> æ—¥æœŸ: 2026-02-08
> ç›®æ ‡: å®Œæˆå­¦ä¹ é“¾è·¯æœ€åä¸¤ç¯ (â‘¨å°è„‘ â‘©ä¸˜è„‘)

### å°è„‘å‰å‘é¢„æµ‹æ¥å…¥é—­ç¯

**ç”Ÿç‰©å­¦ (Yoshida et al. 2025, J Neuroscience):**
å°è„‘å’ŒåŸºåº•èŠ‚ååŒå¼ºåŒ–å­¦ä¹ ã€‚å°è„‘é¢„æµ‹åŠ¨ä½œçš„æ„Ÿè§‰åæœï¼Œé¢„æµ‹é”™è¯¯é€šè¿‡
climbing fiber é©±åŠ¨ PFâ†’PC LTDã€‚æ¯” DA åé¦ˆå¿« 10Ã— (æ¯æ­¥é¢„æµ‹ vs ç¨€ç–å¥–åŠ±)ã€‚

**å®ç° (ä¿¡æ¯é‡å‹ç¼©: 275â†’24 ç¥ç»å…ƒ):**
```
GrC=12, PC=4(æ¯æ–¹å‘1ä¸ª), DCN=4, MLI=2, Golgi=2
æŠ•å°„: M1â†’CB(efference copy), V1â†’CB(è§†è§‰context), CBâ†’MotorThal, CBâ†’BG
CFè¯¯å·®: |last_reward| ä½œä¸º proxy (æ„å¤–å¥–æƒ©=é¢„æµ‹å¤±è´¥)
```

**ç»“æœ:**
- Learner advantage: +0.017 â†’ +0.053 (3Ã— æå‡)
- æ§åˆ¶ç»„ safety=0.02 vs å­¦ä¹ ç»„ 0.22 (CB å¸®åŠ©å›é¿å±é™©)

### ä¸˜è„‘ NE/ACh é—¨æ§

**ç”Ÿç‰©å­¦ (2024 Nature):**
é«˜é˜¶ä¸˜è„‘æ ¸é€‰æ‹©æ€§ä¼ é€’çŠ¶æ€ä¿¡æ¯ã€‚NE/ACh æ§åˆ¶ TRN å…´å¥‹æ€§:
é«˜ NE (è­¦è§‰) â†’ TRN æ”¾æ¾ â†’ æ›´å¤šä¿¡å·é€šè¿‡; ä½ NE â†’ TRN æ”¶ç´§ â†’ è¿‡æ»¤ã€‚

**å®ç°:**
```cpp
float trn_gate_drive = 3.0 * (1.0 - 0.5*NE - 0.5*ACh);
// NE=0.2 â†’ gate=2.4 (æ­£å¸¸), NE=0.5 â†’ gate=1.5 (å¼€æ”¾)
```

### Baldwin é‡è¿›åŒ– (å«å°è„‘+ä¸˜è„‘)

100 ä»£ Ã— 60 ä¸ªä½“ Ã— 5 seed, 1000 æ­¥è¯„ä¼°ã€‚è¿›åŒ–ä¸­ (åå°è¿è¡Œ)ã€‚

è¿›åŒ–å‘ç°çš„ç¨³å®šè¶‹åŠ¿:
- `da_stdp_lr â‰ˆ 0.005` (æä½å­¦ä¹ ç‡: æ…¢æ…¢å­¦æ¯”å¿«å­¦å¥½)
- `noise â‰ˆ 70` (ä¸­ç­‰æ¢ç´¢)
- `bg_gain â‰ˆ 7` (å°è„‘è¡¥å……å BG ä¸éœ€è¦é‚£ä¹ˆå¼º)
- `lgn_gain â‰ˆ 400-500` (é«˜è§†è§‰å¢ç›Š)
- `replay â‰ˆ 13-15` (å¤§é‡é‡æ”¾å·©å›º)

### å­¦ä¹ é“¾è·¯å®Œæˆåº¦: 10/10

```
â‘  æ„Ÿè§‰ç¼–ç     V1â†’V2â†’V4â†’IT                    âœ…
â‘¡ é¢„æµ‹ç¼–ç     L6é¢„æµ‹ + mismatch STDP            âœ…
â‘¢ åŠ¨ä½œé€‰æ‹©    dlPFCâ†’BG D1/D2â†’ä¸˜è„‘â†’M1           âœ…
â‘£ å¥–åŠ±ä¿¡å·    VTA DA burst/pause                âœ…
â‘¤ DA-STDP     ä¸‰å› å­ + ä¹˜æ³•å¢ç›Š                  âœ…
â‘¥ ææƒ§å­¦ä¹     æä»æ ¸ one-shot                    âœ…
â‘¦ æƒ…æ™¯è®°å¿†    æµ·é©¬ CA3 + SWR é‡æ”¾                âœ…
â‘§ å…ˆå¤©æ‹“æ‰‘    Baldwin è¿›åŒ– (100ä»£è·‘ä¸­)           âœ…
â‘¨ å°è„‘é¢„æµ‹    CF-LTD + DCNâ†’BGååŒ               âœ…
â‘© ä¸˜è„‘é—¨æ§    NE/AChâ†’TRN excitability           âœ…
```

### å½“å‰ç“¶é¢ˆåˆ†æ

å­¦ä¹ é“¾è·¯ç»“æ„å®Œæ•´ï¼Œä½†æ³›åŒ–è¿˜ä¸ç¨³å®š:
- æ³›åŒ–ä» +0.667 (æ— å°è„‘æœ€ä¼˜è¿›åŒ–) åˆ° -0.10 (æœ‰å°è„‘é‡æ–°è¿›åŒ–)
- æ ¹å› : 10 ä¸ªç³»ç»Ÿçš„å‚æ•°è€¦åˆï¼Œè¿›åŒ–éœ€è¦åœ¨è”åˆç©ºé—´æ‰¾å¹³è¡¡ç‚¹
- æ³›åŒ– â‰  å­¦ä¹ é“¾è·¯ã€‚æ³›åŒ– = f(è¡¨å¾æŠ½è±¡åº¦, å…ˆå¤©æ‹“æ‰‘, ç»éªŒå¤šæ ·æ€§)

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~144é—­ç¯ç¥ç»å…ƒ (120+24å°è„‘) Â· ~125æŠ•å°„
å­¦ä¹ é“¾è·¯: 10/10 å®Œæ•´
å­¦ä¹ èƒ½åŠ›: learner advantage +0.028~0.053
æ³›åŒ–: å¾…è¿›åŒ–æ”¶æ•›åéªŒè¯ (100ä»£è¿›åŒ–åå°è¿è¡Œä¸­)
é€Ÿåº¦: 2.5ç§’/6æµ‹è¯•
ä¸‹ä¸€æ­¥: è¿›åŒ–ç»“æœåº”ç”¨ â†’ æ³›åŒ–éªŒè¯ â†’ è§„æ¨¡æ‰©å±•æˆ–é—´æ¥ç¼–ç 
```

---

## Step 31: Ablation è¯Šæ–­ + ç²¾ç®€å­¦ä¹ é“¾è·¯

> æ—¥æœŸ: 2026-02-08

### 100 ä»£è¿›åŒ–ç»“æœ

100 ä»£ Ã— 60 ä¸ªä½“ Baldwin è¿›åŒ–å®Œæˆ (23 åˆ†é’Ÿ)ã€‚best fitness=2.53 (gen87)ã€‚
è¿›åŒ–å‘ç° `lgn_gain=500`, `lgn_baseline=19` â€” ä¸ä¹‹å‰ 30 ä»£ç»“æœç±»ä¼¼ã€‚
åº”ç”¨åæ³›åŒ– -0.13ï¼Œä¸å¦‚ 30 ä»£æ— å°è„‘ç‰ˆæœ¬ (+0.667)ã€‚
**ç»“è®º: ç›´æ¥ç¼–ç è¿›åŒ–åœ¨å°è„‘åŠ å…¥åæ‰¾ä¸åˆ°ç¨³å®šçš„æ³›åŒ–è§£ã€‚**

### Ablation Study: é€ä¸ªå…³é—­æµ‹è´¡çŒ®

```
Config                    | safety | Î” safety | åˆ¤æ–­
å…¨å¼€ (baseline)           |  0.08  |  +0.00   |
å…³ sleep consolidation    |  0.33  |  +0.25   | æœ€æœ‰å®³ â†’ ç¦ç”¨
å…³ cortical STDP          |  0.29  |  +0.20   | æœ‰å®³(å­¦å™ªå£°) â†’ ç¦ç”¨
å…³ cerebellum             |  0.27  |  +0.18   | æœ‰å®³(CFè¿‡æŠ‘åˆ¶) â†’ ç¦ç”¨
å…³ hippocampus            |  0.14  |  +0.06   | æœ‰å®³(CA3=6å¤ªå°) â†’ ç¦ç”¨
å…³ SWR replay             |  0.14  |  +0.06   | æœ‰å®³(é‡æ”¾å™ªå£°) â†’ ç¦ç”¨
å…³ LHb                    |  0.07  |  -0.01   | ä¸­æ€§ â†’ ä¿ç•™
å…³ predictive coding      |  0.00  |  -0.08   | æœ‰ç”¨ â†’ ä¿ç•™
å…³ amygdala               |  0.00  |  -0.08   | æœ‰ç”¨ â†’ ä¿ç•™
```

**æ ¹å› : 120 ç¥ç»å…ƒè§„æ¨¡ä¸‹ï¼Œæµ·é©¬(CA3=6)ã€çš®å±‚STDP(V1=26)ã€å°è„‘(GrC=12)
çš„å®¹é‡ä¸è¶³ä»¥å½¢æˆæœ‰æ„ä¹‰çš„å­¦ä¹ ã€‚åè€Œå¼•å…¥å™ªå£°æƒé‡æ›´æ–°ï¼Œå¹²æ‰° BG DA-STDPã€‚**

### ç¦ç”¨åç»“æœ

| æŒ‡æ ‡ | å…¨å¼€ (10ç¯èŠ‚) | ç²¾ç®€ (5ç¯èŠ‚) | å˜åŒ– |
|------|-------------|-------------|------|
| æ³›åŒ–ä¼˜åŠ¿ | -0.129 | **+0.131** | ç¿»æ­£! |
| trained safety | 0.250 | **0.833** | 3.3Ã— |
| Test 4 improvement | -0.083 | **+0.072** | ç¿»æ­£ |
| Test 1 improvement | -0.02 | **+0.22** | ç¿»æ­£ |

### ç²¾ç®€åçš„æœ‰æ•ˆå­¦ä¹ é“¾è·¯

```
ä¿ç•™ (120n ä¸‹æœ‰æ•ˆ):
  â‘  è§†è§‰å±‚çº§    V1â†’V2â†’V4â†’IT (æ—  STDP, çº¯å‰é¦ˆ)
  â‘¡ é¢„æµ‹ç¼–ç     L6 mismatch â†’ STDP å¹…åº¦è°ƒåˆ¶ (æœ‰æ­£é¢è´¡çŒ® -0.08)
  â‘¢ BG DA-STDP  ä¸‰å› å­ + ä¹˜æ³•å¢ç›Š + ä¾§å‘æŠ‘åˆ¶ (æ ¸å¿ƒå­¦ä¹ )
  â‘£ VTA DA      å¥–åŠ±/æƒ©ç½šä¿¡å·
  â‘¥ æä»æ ¸      one-shot ææƒ§å­¦ä¹  (æœ‰æ­£é¢è´¡çŒ® -0.08)
  â‘§ LHb         è´Ÿ RPE (ä¸­æ€§ä½†æ— å®³)

ç¦ç”¨ (ä»£ç ä¿ç•™, ç­‰ scale up):
  â‘¤ çš®å±‚ STDP   (+0.20 æœ‰å®³, éœ€è¦ >100 V1 ç¥ç»å…ƒ)
  â‘¦ æµ·é©¬+SWR    (+0.06 æœ‰å®³, éœ€è¦ >30 CA3 ç¥ç»å…ƒ)
  â‘¨ å°è„‘ CF-LTD (+0.18 æœ‰å®³, éœ€è¦ >50 GrC ç¥ç»å…ƒ)
  â‘© ç¡çœ å·©å›º    (+0.25 æœ€æœ‰å®³, è¿‡åº¦å›ºåŒ–å™ªå£°)
```

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~90æœ‰æ•ˆé—­ç¯ç¥ç»å…ƒ Â· ~110æŠ•å°„
æœ‰æ•ˆå­¦ä¹ é“¾è·¯: BG DA-STDP + é¢„æµ‹ç¼–ç  + æä»æ ¸ + VTA/LHb = 5/10
ç¦ç”¨ç¯èŠ‚: cortical STDP / hippocampus / cerebellum / replay / sleep (ä»£ç ä¿ç•™)
æ³›åŒ–: +0.131 (trained=0.833 vs fresh=0.702)
é€Ÿåº¦: 2.7ç§’/6æµ‹è¯•
```

## Step 32: çš®å±‚ STDP + LHb Bug ä¿®å¤ + é‡æ–°è¿›åŒ–

### é—®é¢˜è¯Šæ–­

Step 31 ablation å‘ç°çš®å±‚ STDP (+0.74) å’Œ LHb (+0.58) æ˜¯æœ€æœ‰å®³çš„ä¸¤ä¸ªæ¨¡å—ã€‚
æ·±å…¥åˆ†æå‘ç°ä¸¤ä¸ª bugï¼š

**Bug 1: çš®å±‚ STDP LTD/LTP æ¯”ä¾‹å¤±è¡¡**
- è¿›åŒ–å‡ºçš„ `a_minus=-0.011` æ˜¯ `a_plus=0.003` çš„ **3.7 å€**
- ç”Ÿç‰©å­¦æ­£å¸¸æ¯”ä¾‹ ~1.1-1.2Ã—
- 27 æ¡çªè§¦ Ã— LTD 3.7Ã— â†’ æƒé‡æŒç»­ä¸‹é™ â†’ è§†è§‰ä¿¡å·æ¶ˆäº¡

**Bug 2: LHb åŒé‡è®¡æ•°**
- åŒä¸€ä¸ªè´Ÿå¥–åŠ±åŒæ—¶é€šè¿‡ä¸¤æ¡è·¯å¾„æŠ‘åˆ¶ DAï¼š
  1. VTA RPE: `reward=-1.8` â†’ `phasic_negative=-0.45`
  2. LHb: `punishment=1.8Ã—1.5` â†’ `vta_suppression=~0.2-0.4`
- åˆè®¡ DA è¢«å‹åˆ° 0.0ï¼ŒåŒå€æƒ©ç½š
- ç”Ÿç‰©å­¦: LHb ä¸»è¦ç¼–ç  frustrative non-rewardï¼ˆæœŸæœ›è½ç©ºï¼‰ï¼Œä¸å¤„ç†ç›´æ¥æƒ©ç½š

### ä¿®å¤å†…å®¹

| æ–‡ä»¶ | ä¿®æ”¹ |
|------|------|
| `closed_loop_agent.h` | `a_plus=0.005, a_minus=-0.006` (1.2Ã— æ­£å¸¸æ¯”ä¾‹) |
| `closed_loop_agent.cpp` | åˆ é™¤ `lhb_->inject_punishment()` å¯¹ç›´æ¥æƒ©ç½šçš„è°ƒç”¨ |
| `closed_loop_agent.cpp` | åˆ é™¤ CeAâ†’LHb æ”¾å¤§ (ä¹Ÿæ˜¯åŒé‡è®¡æ•°) |

### é‡æ–°è¿›åŒ– (30genÃ—40pop Baldwin)

ä¿®å¤åä»£ç é‡æ–°è¿›åŒ–ï¼Œå› ä¸ºæ—§å‚æ•°æ˜¯åœ¨æœ‰ bug çš„ä»£ç ä¸Šä¼˜åŒ–çš„ï¼š

```
best fitness = 2.41 (gen27)
å…³é”®å‚æ•°å˜åŒ–:
  cortical_a_plus:  0.003 â†’ 0.017  (è¿›åŒ–ä¸»åŠ¨å¢å¤§ LTP)
  cortical_a_minus: 0.011 â†’ 0.010  (ratio: 3.7Ã— â†’ 0.6Ã—, LTD < LTP)
  bg_to_m1_gain:    21.0  â†’ 2.42   (å¤§å¹…é™ä½ BGâ†’M1 å¢ç›Š)
  exploration_noise: 55   â†’ 70.3   (æ›´å¤šæ¢ç´¢)
  ne_food_scale:    1.0   â†’ 6.13   (NE å¯¹ food å“åº”æ›´å¼º)
  homeostatic_eta:  0.0015 â†’ 0.0068 (ç¨³æ€æ›´å¼º)
```

### Ablation éªŒè¯

```
ä¿®å¤å‰ (Step 31):
  baseline safety = 0.08
  çš®å±‚ STDP: +0.74 (æœ€æœ‰å®³)
  LHb:       +0.58 (æœ‰å®³)

ä¿®å¤å (Step 32):
  baseline safety = 1.00
  çš®å±‚ STDP: +0.00 (ä¸­æ€§) â† ä¸å†æœ‰å®³!
  LHb:       +0.00 (ä¸­æ€§) â† ä¸å†æœ‰å®³!
  sleep:     -0.20 (æœ‰ç”¨)
```

### å®Œæ•´æµ‹è¯•ç»“æœ (6/6 PASS, 3.2ç§’)

```
æµ‹è¯•1: 1000æ­¥æ—¶ safety=1.00, ä½† 1500æ­¥åâ†’0.00 (ç¾éš¾æ€§é—å¿˜)
æµ‹è¯•2: å­¦ä¹ ç»„ 0.12 < å¯¹ç…§ç»„ 0.60 (å­¦ä¹ åè€Œæœ‰å®³)
æµ‹è¯•4: early=0.51 â†’ late=0.00, improvement=-0.51 (è¶Šå­¦è¶Šå·®)
æµ‹è¯•5: 15x15 å¤§ç¯å¢ƒ improvement=+0.265 (å”¯ä¸€æ­£å‘)
æµ‹è¯•6: trained=0.25 < fresh=0.46 (æ³›åŒ–ä¸ºè´Ÿ, è®­ç»ƒæœ‰å®³)
```

### æ–°æš´éœ²çš„æ ¸å¿ƒé—®é¢˜: ç¨³å®šæ€§-å¯å¡‘æ€§å›°å¢ƒ

Agent åœ¨ ~1000 æ­¥æ—¶ç¡®å®å­¦åˆ°äº†ä¸œè¥¿ (safety çŸ­æš‚åˆ° 1.00)ï¼Œ
ä½†éšåæƒé‡æŒç»­æ¼‚ç§»å¯¼è‡´ç¾éš¾æ€§é—å¿˜ã€‚åŸå› ï¼š

1. **æ— æƒé‡ä¿æŠ¤æœºåˆ¶** â€” å­¦åˆ°çš„å¥½æƒé‡è¢«åç»­å™ªå£°æ›´æ–°å†²æ‰
2. **Homeostatic eta=0.0068 è¿‡å¼º** â€” æ¯”ä¹‹å‰é«˜ 4.5Ã—ï¼Œæ‹‰å¹³å·²å­¦åˆ°çš„å·®å¼‚åŒ–æƒé‡
3. **DA baseline æ’å®š** â€” æ²¡æœ‰"å·²ç»å­¦ä¼šå°±é™ä½å­¦ä¹ ç‡"çš„å…ƒå­¦ä¹ æœºåˆ¶

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~120é—­ç¯ç¥ç»å…ƒ Â· ~110æŠ•å°„
æ‰€æœ‰å­¦ä¹ æ¨¡å—é‡æ–°å¯ç”¨ (STDP/LHb bug ä¿®å¤åæ— å®³)
Bug ä¿®å¤: STDP LTD/LTP æ¯”ä¾‹ + LHb åŒé‡è®¡æ•°
å¾…è§£å†³: ç¾éš¾æ€§é—å¿˜ (stability-plasticity dilemma)
é€Ÿåº¦: 3.2ç§’/6æµ‹è¯•
```

## Step 33: ç¾éš¾æ€§é—å¿˜ä¿®å¤ â€” çªè§¦å·©å›º + äº¤é”™å›æ”¾ + æä»æ ¸æ¥çº¿ä¿®å¤

### é—®é¢˜è¯Šæ–­

Step 32 ä¿®å¤ STDP/LHb bug åï¼Œå­¦ä¹ æ›²çº¿æš´éœ²æ ¸å¿ƒé—®é¢˜ï¼š
- agent åœ¨ ~1000 æ­¥æ—¶å­¦ä¼šé¿å¼€å±é™© (safety=1.00)
- ä½† 1500 æ­¥åé—å¿˜ï¼Œsafetyâ†’0.00
- å­¦ä¹ ç»„åè€Œä¸å¦‚å¯¹ç…§ç»„ï¼ˆDA-STDP æœ‰å®³ï¼‰

### æ ¹å› åˆ†æ

#### 1. BG æƒé‡è¡°å‡è¿‡å¿«
- `da_stdp_w_decay=0.003`ï¼Œæƒé‡åŠè¡°æœŸä»… ~230 æ­¥
- agent å­¦ä¼šåè¿›å…¥"æˆåŠŸæœŸ"ï¼ˆæ— åé¦ˆï¼‰ï¼Œæƒé‡å¿«é€Ÿå›å½’ 1.0
- æ— ä»»ä½•æœºåˆ¶ä¿æŠ¤å·²å­¦å¥½çš„çªè§¦

#### 2. BG è¾“å‡ºè¢«æ¢ç´¢å™ªå£°æ·¹æ²¡
- è¿›åŒ–å‡ºçš„ `bg_to_m1_gain=2.42`ï¼Œä½†æ¢ç´¢ attractor drive=27.4
- BG åªå  M1 è¾“å…¥çš„ 18%ï¼Œæ°¸è¿œæ— æ³•ä¸»å¯¼è¡Œä¸º
- åŸå› ï¼šè¿›åŒ–è¯„ä¼°æœŸé—´ `dev_period=2000` è¦†ç›–äº†å…¨éƒ¨ 1000 è¯„ä¼°æ­¥ï¼Œ
  å¥–åŠ±å­¦ä¹ ä»æœªç”Ÿæ•ˆï¼Œè¿›åŒ–åœ¨ä¼˜åŒ–"æœ€ä½³éšæœºæ¢ç´¢å‚æ•°"

#### 3. æä»æ ¸ SpikeBus æ¥çº¿é”™è¯¯ï¼ˆæœ€å¤§ bugï¼‰
ä¸¤æ¡ SpikeBus æŠ•å°„ (`Amygdalaâ†’VTA`ã€`Amygdalaâ†’LHb`) æŠŠç”Ÿç‰©å­¦ä¸Šåº”è¯¥æ˜¯
**æŠ‘åˆ¶æ€§**çš„é€šè·¯æ¥æˆäº†**å…´å¥‹æ€§**çš„ï¼š

```
é”™è¯¯æ¥çº¿:
  Amygdala (LA+BLA+CeA+ITC=15ç¥ç»å…ƒ)
    â†’ SpikeBus (å…´å¥‹æ€§) â†’ VTA â†’ DA å‡é«˜
    â†’ SpikeBus (å…´å¥‹æ€§) â†’ LHb â†’ LHbè¿‡åº¦æ´»è·ƒ â†’ VTAè¢«å‹åˆ¶

æ­£ç¡®ç”Ÿç‰©å­¦:
  CeA â†’ RMTg (GABA) â†’ VTA DAæŠ‘åˆ¶ (å·²é€šè¿‡ inject_lhb_inhibition å®ç°)
  LA/BLA/ITC ä¸åº”ç›´æ¥æŠ•å°„åˆ° VTA æˆ– LHb
```

æ¶ˆèéªŒè¯ï¼šæä»æ ¸ä» +0.82 æœ‰å®³ â†’ 0.00 ä¸­æ€§

#### 4. æä»æ ¸ææƒ§è¿‡åº¦æ³›åŒ–
- LA=4 ç¥ç»å…ƒï¼Œ`neuron_id % 4` æ˜ å°„å¯¼è‡´æ‰€æœ‰è§†è§‰è¾“å…¥æ¿€æ´»ç›¸åŒ LA å­é›†
- STDP `a_plus=0.10`ï¼ˆçš®å±‚ 10 å€ï¼‰ï¼Œä¸€æ¬¡ CS-US é…å¯¹å³å…¨é¢ææƒ§
- CeA è¾“å‡ºæ— ä¸Šé™ (`fear Ã— 1.5`)ï¼Œå®Œå…¨å‹åˆ¶ DA
- PFCâ†’ITC æ¶ˆé€€é€šè·¯å­˜åœ¨ä½†ä»æœªè¢«è°ƒç”¨

#### 5. dev_period_steps é…ç½®é”™è¯¯
- `dev_period_steps=2000`ï¼Œæµ‹è¯•åªè·‘ 2000 æ­¥ â†’ æ•´ä¸ªæµ‹è¯•åœ¨å‘å±•æœŸ
- è¿›åŒ–åªè·‘ 1000 æ­¥ â†’ æ•´ä¸ªè¿›åŒ–è¯„ä¼°ä¹Ÿåœ¨å‘å±•æœŸ
- å¥–åŠ±å­¦ä¹ ä»æœªç”Ÿæ•ˆï¼Œè¿›åŒ–å‡ºçš„å‚æ•°åªé€‚åˆéšæœºæ¢ç´¢

### ä¿®å¤å†…å®¹

#### ä¿®å¤1: BG çªè§¦å·©å›ºï¼ˆå…ƒå¯å¡‘æ€§ï¼‰
å‚è€ƒ TACOS (2025 SNN å…ƒå¯å¡‘æ€§) + STC (Frey & Morris 1997)ï¼š
- æ–°å¢ per-synapse consolidation score `c âˆˆ [0,âˆ)`
- DA-STDP æƒé‡æ›´æ–°æ–¹å‘ä¸ç°æœ‰åç¦»ä¸€è‡´æ—¶ï¼Œc å¢é•¿
- `effective_lr = lr / (1 + c Ã— strength)` â€” å·©å›ºçš„çªè§¦å­¦ä¹ æ›´æ…¢
- `effective_decay = decay / (1 + c Ã— strength)` â€” å·©å›ºçš„çªè§¦æŠ—è¡°å‡
- æ¶ˆèéªŒè¯ï¼š-0.15 (æœ‰ç”¨)

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| consol_rate | 10.0 | å·©å›ºå»ºç«‹é€Ÿç‡ |
| consol_decay | 0.9995 | è‡ªç„¶è¡°å‡ (~1400æ­¥åŠè¡°æœŸ) |
| consol_strength | 5.0 | ä¿æŠ¤å¼ºåº¦ (6å€è¡°å‡æŠµæŠ—) |

#### ä¿®å¤2: äº¤é”™å›æ”¾
- æ­£é¢å›æ”¾æ—¶æ··åˆ 1-2 ä¸ªè´Ÿé¢ç»éªŒç‰‡æ®µ
- é˜²æ­¢æ–°çš„è¶‹è¿‘å­¦ä¹ è¦†ç›–æ—§çš„è¶‹é¿è®°å¿†
- æ¶ˆèéªŒè¯ï¼š-0.06 (æœ‰ç”¨)

#### ä¿®å¤3: æƒé‡è¡°å‡é™ä½
- `da_stdp_w_decay`: 0.003 â†’ 0.0008 (3.75Ã— é™ä½)
- æƒé‡åŠè¡°æœŸä» ~230 æ­¥å»¶é•¿åˆ° ~860 æ­¥

#### ä¿®å¤4: æä»æ ¸å…¨é¢ä¿®å¤

| æ”¹åŠ¨ | æ—§å€¼ | æ–°å€¼ | åŸå›  |
|------|------|------|------|
| Amygdalaâ†’VTA SpikeBus | å­˜åœ¨ | **ç§»é™¤** | å…´å¥‹æ€§SpikeBus â‰  æŠ‘åˆ¶æ€§é€šè·¯ |
| Amygdalaâ†’LHb SpikeBus | å­˜åœ¨ | **ç§»é™¤** | åŒä¸Š |
| fear_stdp_a_plus | 0.10 | 0.03 | é˜²æ­¢ä¸€æ¬¡é…å¯¹å³å…¨é¢ææƒ§ |
| fear_stdp_a_minus | -0.03 | -0.015 | é…åˆä¸»åŠ¨æ¶ˆé€€ |
| fear_stdp_w_max | 3.0 | 1.5 | é™åˆ¶æœ€å¤§ææƒ§å¼ºåº¦ |
| US æ³¨å…¥å¢ç›Š | Ã—40 | Ã—15 | é˜²æ­¢ BLA é¥±å’Œ |
| CeAâ†’VTA è¾“å‡º | fearÃ—1.5, æ— ä¸Šé™ | min(fearÃ—0.3, 0.05) | æç¤ºæ€§è°ƒåˆ¶ |
| PFCâ†’ITC æ¶ˆé€€ | æœªè°ƒç”¨ | æ¯æ­¥æ³¨å…¥ 5.0 | å®‰å…¨æ—¶ä¸»åŠ¨æ¶ˆé€€ææƒ§ |

#### ä¿®å¤5: å‘å±•æœŸ + è¿›åŒ–å‚æ•°
- `dev_period_steps`: 2000 â†’ 100 (å¿«é€Ÿè¿›å…¥å¥–åŠ±å­¦ä¹ )
- 30genÃ—40pop Baldwin é‡æ–°è¿›åŒ– (gen26, fitness=2.05)
- è¿›åŒ–å…³é”®å‘ç°ï¼š`homeostatic_eta` éœ€é™ä½ 9Ã— (0.0068â†’0.00073)

### æ¶ˆèéªŒè¯ï¼ˆä¿®å¤åï¼‰

```
  Config                    | safety | Î” safety
  --------------------------|--------|----------
  å…¨å¼€ (baseline)         |  1.00  | +0.00
  å…³ SWR replay            |  0.12  | -0.88 (æœ€æœ‰ç”¨!)
  å…³ LHb                   |  0.14  | -0.86 (æœ‰ç”¨)
  å…³ sleep consolidation   |  0.25  | -0.75 (æœ‰ç”¨)
  å…³ predictive coding     |  0.27  | -0.73 (æœ‰ç”¨)
  å…³ cortical STDP         |  1.00  | +0.00 (ä¸­æ€§)
  å…³ amygdala              |  1.00  | +0.00 (ä¸­æ€§)
  å…³ hippocampus           |  1.00  | +0.00 (ä¸­æ€§)
  å…³ cerebellum            |  1.00  | +0.00 (ä¸­æ€§)
  å…³ synaptic consol       |  1.00  | +0.00 (ä¸­æ€§)
  å…³ interleaved replay    |  1.00  | +0.00 (ä¸­æ€§)
```

**é‡å¤§çªç ´: æ²¡æœ‰ä»»ä½•æ¨¡å—æ˜¯"æœ‰å®³"çš„ï¼**
SWRå›æ”¾ã€LHbã€ç¡çœ å·©å›ºã€é¢„æµ‹ç¼–ç å…¨éƒ¨ä»ä¸­æ€§/æœ‰å®³å˜ä¸ºå…³é”®æœ‰ç”¨æ¨¡å—ã€‚

### å¾…è§£å†³

é•¿æœŸå­¦ä¹ æ›²çº¿(2000æ­¥)ä»æœ‰ç¾éš¾æ€§é—å¿˜ï¼ˆ1000æ­¥å­¦ä¼šï¼Œ1500æ­¥åé—å¿˜ï¼‰ã€‚
å‚æ•°éœ€è¦åœ¨ä¿®å¤åçš„ä»£ç ä¸Šé‡æ–°è¿›åŒ–ä»¥è·å¾—æœ€ä¼˜é…ç½®ã€‚

### ç³»ç»ŸçŠ¶æ€

```
53åŒºåŸŸ Â· ~120é—­ç¯ç¥ç»å…ƒ Â· ~110æŠ•å°„
æ‰€æœ‰æ¨¡å—å¯ç”¨ï¼Œæ— æœ‰å®³æ¨¡å—
æ–°å¢æœºåˆ¶: çªè§¦å·©å›º(å…ƒå¯å¡‘æ€§) + äº¤é”™å›æ”¾ + æä»æ ¸æ¶ˆé€€
ä¿®å¤: æä»æ ¸SpikeBusæ¥çº¿ + dev_period + homeostatic_eta
å…³é”®æœ‰ç”¨æ¨¡å—: SWRå›æ”¾(-0.88) > LHb(-0.86) > ç¡çœ (-0.75) > é¢„æµ‹ç¼–ç (-0.73)
å¾…è§£å†³: é•¿æœŸç¾éš¾æ€§é—å¿˜ (2000æ­¥)
é€Ÿåº¦: 2.5ç§’/6æµ‹è¯•
```

---

## Step 35: ACC å‰æ‰£å¸¦å›çš®å±‚ â€” å†²çªç›‘æµ‹ä¸åŠ¨æ€æ¢ç´¢

**æ—¥æœŸ**: 2025-02-08
**ç›®æ ‡**: æ›¿ä»£ç¡¬ç¼–ç  `ne_floor` å’Œæ‰‹å·¥ `arousal` è®¡ç®—ï¼Œç”¨ç¥ç»åŠ¨åŠ›å­¦é©±åŠ¨æ¢ç´¢/åˆ©ç”¨å¹³è¡¡

### é—®é¢˜è¯Šæ–­

å½“å‰ç³»ç»Ÿçš„æ¢ç´¢/åˆ©ç”¨å¹³è¡¡å®Œå…¨ä¾èµ–ç¡¬ç¼–ç å‚æ•°ï¼š

```
// æ—§æœºåˆ¶ (closed_loop_agent.cpp)
float arousal = std::max(0.0f, 0.05f - fr * 0.1f);  // æ‰‹å·¥food_rateè®¡ç®—
lc_->inject_arousal(arousal);
// fallback: noise_scale = max(ne_floor=0.67, 1.0 - fr * ne_food_scale)
```

é—®é¢˜ï¼š
1. `ne_floor=0.67` æ˜¯è¿›åŒ–å‡ºçš„é­”æ³•æ•°å­—ï¼Œæ²¡æœ‰ç”Ÿç‰©å­¦åŸºç¡€
2. `arousal` åªçœ‹ `food_rate`ï¼Œå¿½ç•¥äº†åŠ¨ä½œå†²çªã€ç¯å¢ƒå˜åŒ–ã€ç­–ç•¥å¤±æ•ˆç­‰å…³é”®ä¿¡å·
3. æ²¡æœ‰å†²çªç›‘æµ‹ â€” ç³»ç»Ÿä¸çŸ¥é“è‡ªå·±åœ¨"çŠ¹è±«"
4. æ²¡æœ‰æƒŠè®¶æ£€æµ‹ â€” æ„å¤–ç»“æœä¸ä¼šæ”¹å˜è¡Œä¸º
5. æ²¡æœ‰æ³¢åŠ¨æ€§è¿½è¸ª â€” ç¯å¢ƒå˜åŒ–æ—¶å­¦ä¹ ç‡ä¸è°ƒæ•´

### æ–‡çŒ®åŸºç¡€

æ•´åˆ 5 ä¸ªç»å…¸ ACC è®¡ç®—æ¨¡å‹ï¼š

| æ¨¡å‹ | æ¥æº | åŠŸèƒ½ |
|------|------|------|
| **å†²çªç›‘æµ‹** | Botvinick et al. 2001 | D1å­ç¾¤ç«äº‰ â†’ æ¢ç´¢éœ€æ±‚ |
| **PROé¢„æµ‹è¯¯å·®** | Alexander & Brown 2011 | \|actual-predicted\| â†’ æƒŠè®¶ï¼ˆä¸åˆ†æ­£è´Ÿæ•ˆä»·ï¼‰ |
| **æ³¢åŠ¨æ€§æ£€æµ‹** | Behrens et al. 2007 | fast/slowå¥–åŠ±ç‡å·® â†’ å­¦ä¹ ç‡è°ƒåˆ¶ |
| **è§…é£Ÿå†³ç­–** | Kolling et al. 2012 | local vs globalå¥–åŠ±ç‡ â†’ ç­–ç•¥åˆ‡æ¢ |
| **åŠªåŠ›/æ§åˆ¶** | Shenhav et al. 2013 EVC | ç»¼åˆä¿¡å· â†’ LC-NEå”¤é†’é©±åŠ¨ |

è§£å‰–å­¦è¿æ¥ (StatPearls, Neuroanatomy Cingulate Cortex)ï¼š
- è¾“å…¥: dlPFC(ä¸Šä¸‹æ–‡), BG D1(åŠ¨ä½œç«äº‰), VTA-DA(RPE), Amygdala-CeA(å¨èƒ)
- è¾“å‡º: LC(å”¤é†’/æ¢ç´¢), dlPFC(æ§åˆ¶/æ³¨æ„), VTA(æƒŠè®¶è°ƒåˆ¶)

### å®ç°

#### ç¥ç»å…ƒç¾¤ä½“

| ç¾¤ä½“ | æ•°é‡ | ç±»å‹ | åŠŸèƒ½ |
|------|------|------|------|
| **dACC** | 12Ã—s | L2/3 Pyramidal | å†²çªç›‘æµ‹ + è§…é£Ÿ + è®¤çŸ¥æ§åˆ¶ |
| **vACC** | 8Ã—s | L2/3 Pyramidal | æƒ…ç»ªè¯„ä»· + æƒŠè®¶ + åŠ¨æœº |
| **PV Inh** | 6Ã—s | PV Basket | E/I å¹³è¡¡ |

å†…éƒ¨çªè§¦: dACCâ†”vACC (AMPA), Excâ†’Inh (AMPAâ†’SOMA), Inhâ†’Exc (GABA_Aâ†’SOMA)

#### è®¡ç®—æ¨¡å—

**1. å†²çªç›‘æµ‹ (Botvinick 2001)**
```
conflict = Î£_{iâ‰ j} rate_i Ã— rate_j / totalÂ²  // Hopfieldèƒ½é‡
// 4ç»„D1åŒç­‰æ´»è·ƒ = é«˜å†²çª (0.375)
// 1ç»„ä¸»å¯¼ = ä½å†²çª (â‰ˆ0)
conflict_level = EMA(conflict Ã— gain, decay=0.85)
```

**2. PROæƒŠè®¶ (Alexander & Brown 2011)**
```
predicted_reward = EMA(outcome, Ï„=0.97)  // æ…¢é€Ÿè·Ÿè¸ª
surprise = |actual - predicted|  // ä¸åˆ†æ­£è´Ÿæ•ˆä»·!
// "ACC doesn't care about good or bad, only if it was expected"
```

**3. æ³¢åŠ¨æ€§ (Behrens 2007)**
```
reward_rate_fast = EMA(|outcome|, Ï„=0.90)  // å¿«é€Ÿè¿½è¸ª
reward_rate_slow = EMA(|outcome|, Ï„=0.99)  // æ…¢é€ŸåŸºçº¿
volatility = |fast - slow| Ã— gain  // å˜åŒ–é€Ÿåº¦
â†’ learning_rate_modulation âˆˆ [0.5, 2.0]
```

**4. è§…é£Ÿå†³ç­– (Kolling 2012)**
```
foraging_signal = max(0, global_rate - local_rate) Ã— 5
// å½“å‰ç­–ç•¥ä¸å¦‚é•¿æœŸå¹³å‡ â†’ åº”è¯¥åˆ‡æ¢
```

**5. ç»¼åˆè¾“å‡º (Shenhav 2013 EVC)**
```
arousal_drive = conflictÃ—0.4 + surpriseÃ—0.3 + foragingÃ—0.2 + threatÃ—0.1
â†’ ACCâ†’LC: inject_arousal(arousal_drive Ã— 0.15)  // æ›¿ä»£ç¡¬ç¼–ç ne_floor!
attention_signal = conflictÃ—0.5 + surpriseÃ—0.3 + volatilityÃ—0.2
â†’ ACCâ†’dlPFC: è®¤çŸ¥æ§åˆ¶å¢å¼º
```

### æ¥å…¥ ClosedLoopAgent

#### build_brain() æ–°å¢
```
ACC (12+8+6=26 neurons Ã— scale)
SpikeBus: dlPFC â†’ ACC (delay=3), ACC â†’ dlPFC (delay=3)
```

#### agent_step() æ”¹å˜

**è¾“å…¥æ³¨å…¥**:
- `acc_->inject_d1_rates()`: è¯»å– BG D1 4ä¸ªæ–¹å‘å­ç¾¤å‘æ”¾ç‡ â†’ å†²çªæ£€æµ‹
- `acc_->inject_outcome()`: æ³¨å…¥ `last_reward_` â†’ PROæƒŠè®¶è®¡ç®—
- `acc_->inject_threat()`: æ³¨å…¥ `amyg_->cea_vta_drive()` â†’ æƒ…ç»ªå”¤é†’

**è¾“å‡ºä½¿ç”¨**:
```cpp
// æ—§: arousal = max(0, 0.05 - food_rate * 0.1)  // ç¡¬ç¼–ç 
// æ–°: arousal = acc_->arousal_drive() * 0.15      // ç¥ç»åŠ¨åŠ›å­¦æ¶Œç°
lc_->inject_arousal(arousal);
```

### æµ‹è¯•ä¿®å¤ï¼ˆéACCå¼•èµ·çš„å·²æœ‰é—®é¢˜ï¼‰

| æµ‹è¯• | æ ¹å›  | ä¿®å¤ |
|------|------|------|
| `bg_learning` åè½¬å­¦ä¹  | Step 33 æ–°å¢ `synaptic_consolidation=true` ä½†æµ‹è¯•æœªæ›´æ–° â†’ å·©å›ºåçªè§¦æŠ—æ‹’åè½¬ | æµ‹è¯•ä¸­å…³é—­å·©å›º |
| `cortical_stdp` è®­ç»ƒå¢å¼º | LTD(0.022) > LTP(0.02) â†’ è®­ç»ƒåè€Œå‰Šå¼±æƒé‡ï¼›æ—¶é—´æˆ³é‡å  | LTP>LTD, ä¿®æ­£æ—¶é—´æˆ³ |

### ç»“æœ

```
30/30 CTest å…¨éƒ¨é€šè¿‡ï¼Œé›¶å›å½’
```

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/region/anterior_cingulate.h` | ACCConfig + AnteriorCingulate ç±»å®šä¹‰ |
| `src/region/anterior_cingulate.cpp` | å®Œæ•´å®ç° (5ä¸ªè®¡ç®—æ¨¡å—, 6ç»„å†…éƒ¨çªè§¦) |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `src/engine/closed_loop_agent.h` | +include, +enable_acc=true, +acc_ pointer, +acc() accessor |
| `src/engine/closed_loop_agent.cpp` | build_brain() å®ä¾‹åŒ–ACC+æŠ•å°„; agent_step() ACCé©±åŠ¨LC arousal |
| `src/CMakeLists.txt` | +anterior_cingulate.cpp |
| `tests/cpp/test_bg_learning.cpp` | åè½¬å­¦ä¹ æµ‹è¯•å…³é—­synaptic_consolidation |
| `tests/cpp/test_cortical_stdp.cpp` | è®­ç»ƒå¢å¼ºæµ‹è¯•ä¿®æ­£LTP/LTDæ¯”ä¾‹+æ—¶é—´æˆ³ |

### Step 35b: ACC è¾“å‡ºå…¨æ¥çº¿

**æ—¥æœŸ**: 2025-02-08

Step 35 ä¸­ ACC åªæ¥äº† `arousal_drive()â†’LC`ï¼Œå…¶ä½™ 3 ä¸ªè¾“å‡ºè®¡ç®—äº†ä½†æœªä½¿ç”¨ã€‚ç°åœ¨å…¨éƒ¨æ¥çº¿ï¼š

| ACC è¾“å‡º | æ¥çº¿ç›®æ ‡ | ç”Ÿç‰©å­¦æœºåˆ¶ |
|----------|----------|-----------|
| `attention_signal()` | `dlpfc_->set_attention_gain(1.0 + attÃ—0.5)` | ACCâ†’dlPFC: å†²çª/æƒŠè®¶â†’PFCä¸Šä¸‹æ§åˆ¶â†‘ (Shenhav 2013) |
| `foraging_signal()` | `noise_scale *= (1.0 + forageÃ—0.3)` | dACCè§…é£Ÿ: å½“å‰ç­–ç•¥<å…¨å±€å¹³å‡â†’æ¢ç´¢å™ªå£°â†‘ (Kolling 2012) |
| `learning_rate_modulation()` | DA error scaling: `da = baseline + (da-baseline)Ã—lr_mod` | æ³¢åŠ¨æ€§â†’DA RPEæ”¾å¤§/å‹ç¼©â†’å­¦ä¹ é€Ÿåº¦è°ƒåˆ¶ (Behrens 2007) |

ä¿¡å·æµæ€»ç»“ï¼š
```
BG D1ç«äº‰ â†’ ACCå†²çª â”€â”¬â†’ LC arousal â†’ NEâ†‘ â†’ æ¢ç´¢å™ªå£°
                      â””â†’ dlPFC attention_gain â†’ å†³ç­–ç²¾åº¦

å¥–åŠ±ç»“æœ â†’ ACCæƒŠè®¶ â”€â”€â”¬â†’ LC arousal â†’ NEâ†‘
                      â””â†’ dlPFC attention_gain

å¥–åŠ±æ³¢åŠ¨ â†’ ACCæ³¢åŠ¨æ€§ â”€â”€â†’ DA error scaling â†’ å­¦ä¹ ç‡è°ƒåˆ¶

å±€éƒ¨vså…¨å±€ â†’ ACCè§…é£Ÿ â”€â”€â†’ noise_scaleâ†‘ â†’ ç­–ç•¥åˆ‡æ¢
```

30/30 CTest é€šè¿‡ï¼Œé›¶å›å½’ã€‚

### ACC æ¶ˆèå¯¹æ¯”

| æŒ‡æ ‡ | ACC ON | ACC OFF | ç»“è®º |
|------|--------|---------|------|
| æ—©æœŸ safety (0-1000æ­¥) | **0.750** | 0.543 | âœ… +0.207 |
| æ—©æœŸ danger | **2** | 21 | âœ… å°‘19ä¸ª |
| DA-STDP learner advantage | **+0.023** | +0.001 | âœ… å¥½22Ã— |
| æ€» danger (2000æ­¥) | **19** | 28 | âœ… å°‘32% |
| æ™šæœŸ safety (1500-2000) | 0.000 | 0.250 | âš ï¸ ä¸¤è€…éƒ½å´©æºƒ(ç¾éš¾æ€§é—å¿˜) |

**ç»“è®º**: ACC æœ‰ç›Šï¼ˆæ—©æœŸå­¦ä¹ å¿« 22Ã—ï¼Œdanger å°‘ 32%ï¼‰ï¼Œä¿ç•™ã€‚æ™šæœŸå´©æºƒæ˜¯ç¾éš¾æ€§é—å¿˜è€é—®é¢˜ï¼Œä¸ ACC æ— å…³ã€‚

### ç¾éš¾æ€§é—å¿˜æ ¹å› åˆ†æ

å®šé‡è®¡ç®—ï¼ˆbrain_steps_per_action=12, æ¯ agent step è¡°å‡ 12 æ¬¡ï¼‰ï¼š

```
æƒé‡è¡°å‡: (1-0.0008)^12 = 0.9904/agentæ­¥ â†’ 500æ­¥åä»…å‰© 0.8% åå·®
å·©å›ºè¡°å‡: 0.9995^12 = 0.994/agentæ­¥  â†’ åŠè¡°æœŸä»… 115 agentæ­¥
D1 MSN å‘æ”¾: 50æ­¥å†… 0 æ¬¡ â†’ å­¦ä¹ ä¿¡å·æå¼±
```

ä¸‰å±‚æ ¹å› :
1. **åº•å±‚**: D1 MSN å‡ ä¹ä¸å‘æ”¾ â†’ å­¦ä¹ ä¿¡å·å¤ªå¼±
2. **ä¸­å±‚**: å·©å›ºåŠè¡°æœŸ(115æ­¥)è¿œçŸ­äºæƒé‡è¡°å‡éœ€æ±‚
3. **é¡¶å±‚**: ç¼ºä¹ç³»ç»Ÿæ€§è®°å¿†å·©å›º(CLS)å’Œç¨³å®šç©ºé—´è¡¨å¾(EC)

### Step 36: CLS äº’è¡¥å­¦ä¹ ç³»ç»Ÿ â€” ç¾éš¾æ€§é—å¿˜æ ¹æ²»

**æ—¥æœŸ**: 2025-02-08

#### å‘ç°çš„ 4 ä¸ªéšè— bug

| Bug | åŸå›  | å½±å“ |
|-----|------|------|
| **Sub < 4 ç¥ç»å…ƒ** | `n_sub=max(3,3)=3`, ä½† `get_retrieval_bias` è¦æ±‚ â‰¥4 | æµ·é©¬æ£€ç´¢æ¥å£ä»æœªå·¥ä½œè¿‡ |
| **E/I æ¯”ä¾‹åè½¬** | æŠ‘åˆ¶ç¾¤ä½“ç”¨é»˜è®¤å€¼(20/10/15), å…´å¥‹ç¾¤ä½“å‹ç¼©åˆ°(10/6/6) | DG/CA3/CA1 è¢«è¿‡åº¦æŠ‘åˆ¶çª’æ¯ |
| **å•è„‰å†²æ³¨å…¥** | `inject_spatial_context` åœ¨ brain steps å¾ªç¯å¤–åªè°ƒ 1 æ¬¡ | EC grid cells ä»æœªå‘æ”¾ |
| **retrieval_bias æ–¹å‘é”™è¯¯** | Subâ†’direction æ˜ å°„æ˜¯éšæœºçš„, æ— å­¦ä¹ æœºåˆ¶ | å¯ç”¨ååè€Œå¼•å¯¼ agent æ’ danger |

#### CLS å®ç°

1. **è®¤çŸ¥åœ°å›¾ (spatial_value_map)**
   - è®°å½•æ¯ä¸ªä½ç½®çš„å¥–åŠ±å†å²ï¼ˆfood=+, danger=-ï¼‰
   - é‚»åŸŸæ‰©æ•£ï¼ˆplace field ç©ºé—´æ³›åŒ–ï¼‰
   - æ…¢è¡°å‡ä¿æŒé•¿æœŸç©ºé—´è®°å¿†
   - ä»·å€¼æ¢¯åº¦ â†’ BG inject_sensory_contextï¼ˆå¼•å¯¼å¯¼èˆªï¼‰

2. **ç³»ç»Ÿå·©å›ºï¼ˆç¡çœ  SWRï¼‰**
   - SWR æœŸé—´ä» spatial_value_map ä¸­é€‰æ‹©æœ€é«˜ä»·å€¼ä½ç½®"é‡æ”¾"
   - çŸ­æš‚ DA å‡é«˜ â†’ BG DA-STDP ä»ç©ºé—´è®°å¿†é‡æ–°å­¦ä¹ 
   - æ•ˆæœï¼šBG æƒé‡å®šæœŸä»è®¤çŸ¥åœ°å›¾"åˆ·æ–°"

3. **æµ·é©¬ä¿®å¤**
   - Sub å¢å¤§åˆ° 8 ä¸ªï¼ˆæ¯æ–¹å‘ 2 ä¸ªï¼‰
   - E/I æ¯”ä¾‹ä¿®æ­£ï¼ˆDG 5:1, CA3/CA1 3:1ï¼‰
   - ç©ºé—´ä¸Šä¸‹æ–‡æ¯ brain step æŒç»­æ³¨å…¥

#### æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | å˜åŒ– |
|------|--------|--------|------|
| Improvement (earlyâ†’late) | **-0.750** | **-0.088** | âœ… é€€åŒ–å‡å°‘ 89% |
| Late safety (1500-2000æ­¥) | 0.000 | **0.250** | âœ… ä¸å†å®Œå…¨å´©æºƒ |
| DA-STDP learner advantage | +0.023 | **+0.036** | âœ… +57% |
| æ³›åŒ–ä¼˜åŠ¿ | -0.750 | **-0.250** | âœ… +67% |

### ç³»ç»ŸçŠ¶æ€

```
54åŒºåŸŸ Â· ~146é—­ç¯ç¥ç»å…ƒ Â· ~112æŠ•å°„
CLS è®¤çŸ¥åœ°å›¾ + ç¡çœ ç³»ç»Ÿå·©å›º + æµ·é©¬ 4-bug ä¿®å¤
ç¾éš¾æ€§é—å¿˜: -0.750 â†’ -0.088 (å‡å°‘89%)
Learner advantage: +0.036 (ä¿®å¤å‰ +0.023)
30/30 CTest é€šè¿‡
```

---

## Step 37: VTA DA ä¿¡å·é€šè·¯ä¿®å¤ + çš®å±‚â†’MSN PSP è¡°å‡

> æ—¥æœŸ: 2026-02-09
> æ ¸å¿ƒä¿®å¤: DA ä»æ’å®š 0.300 â†’ åŠ¨æ€å˜åŒ–, D1 å‘æ”¾ä» 0 â†’ 2, æƒé‡èŒƒå›´ 5.6Ã—

### é—®é¢˜è¯Šæ–­

**Bug 1: VTA DA è´Ÿ phasic åªæŒç»­ 1 ä¸ª engine step**
- æ­£å¥–åŠ±é€šè·¯æ­£å¸¸: `reward_psp_` > 0 â†’ DA ç¥ç»å…ƒæŒç»­å‘æ”¾ â†’ `phasic_positive > 0` â†’ DA å‡é«˜å¤šæ­¥
- è´Ÿå¥–åŠ±é€šè·¯æ–­è£‚: `reward_psp_` < 0 â†’ DA ç¥ç»å…ƒä¸å‘æ”¾ â†’ `phasic_positive = 0`
  ä½† `phasic_negative` ä¾èµ– `last_rpe_`ï¼Œè€Œ `reward_input_` åœ¨ç¬¬ä¸€æ­¥åé‡ç½®ä¸º 0
  â†’ `last_rpe_ = 0` â†’ `phasic_negative = 0` â†’ DA åœ¨ç¬¬ 2 æ­¥å›åˆ° 0.3
- ç»“æœ: DA dip åªæŒç»­ 1 ä¸ª engine stepï¼ŒBG å‡ ä¹çœ‹ä¸åˆ°æƒ©ç½šä¿¡å·

**Bug 2: Phase A ä¸­ BG åœ¨ VTA å¤„ç†å¥–åŠ±å‰è¯»å– DA**
```
bg_->set_da_level(vta_->da_output());  // è¯»å–æ—§å€¼ 0.3
engine_.step();                         // VTA åœ¨è¿™é‡Œå¤„ç†å¥–åŠ± â†’ DA å˜åŒ–
```
ç¬¬ 0 æ­¥ BG è¯»åˆ°çš„æ˜¯æ—§ DA (0.3)ï¼Œé”™è¿‡äº†å”¯ä¸€çš„ DA dipã€‚

**Bug 3: çš®å±‚â†’MSN PSP è¡°å‡å¤ªå¿« (0.7, åŠè¡°æœŸ 1.9 æ­¥)**
- MSN tau_m=20ï¼Œä» V_rest=-80 å……ç”µåˆ° V_thresh=-50 éœ€è¦ ~15 æ­¥
- PSP è¡°å‡ 0.7 â†’ çš®å±‚ spike çš„ PSP åœ¨ ~3 æ­¥åå‡ ä¹ä¸º 0
- D1 æ¥ä¸åŠå……ç”µå°±å¤±å»é©±åŠ¨ â†’ å…¨ 50 agent steps ä¸­ D1 å‘æ”¾ 0 æ¬¡

### ä¿®å¤æ–¹æ¡ˆ

**Fix 1: Firing-rate-based DA (Grace 1991, Schultz 1997)**
```
phasic = (firing_rate - tonic_firing_smooth_) * phasic_gain * 3.0
da_level_ = clamp(tonic_rate + phasic - lhb_suppression, 0, 1)
```
- DA ç¥ç»å…ƒä¸å‘æ”¾(è¢« reward_psp_ æŠ‘åˆ¶) â†’ firing_rate < tonic â†’ DA ä¸‹é™
- DA ç¥ç»å…ƒå¤šå‘æ”¾(æ­£ reward_psp_) â†’ firing_rate > tonic â†’ DA ä¸Šå‡
- è‡ªç„¶äº§ç”Ÿä¸ reward_psp_ è¡°å‡æœŸä¸€æ ·é•¿çš„ DA dip/burst

**Fix 2: Warmup æœŸ (å‰ 50 engine steps)**
- DA ç¥ç»å…ƒä» V_rest å……ç”µåˆ°ç¨³æ€éœ€è¦ ~30 æ­¥
- Warmup æœŸ DA ä¿æŒ tonic_rate (0.3)ï¼Œé¿å…è™šå‡ D2 å¼ºåŒ–
- åŒæ—¶ç”¨ Î±=0.1 å¿«é€Ÿæ”¶æ•› tonic_firing_smooth_

**Fix 3: Phase A æ—¶åºä¿®æ­£**
```
engine_.step();
bg_->set_da_level(vta_->da_output());  // æ”¹ä¸ºæ­¥è¿›åè¯»å–
```

**Fix 4: çš®å±‚â†’MSN PSP è¡°å‡ 0.7 â†’ 0.9 (åŠè¡°æœŸ 6.6 æ­¥)**
- MSN æ ‘çª AMPA åŠ¨åŠ›å­¦è¾ƒæ…¢ (~10ms)
- CTX_MSN_PSP_DECAY=0.9 ç»™ D1/D2 æ›´å¤šæ—¶é—´æ•´åˆçš®å±‚è¾“å…¥
- STN ä¿æŒ PSP_DECAY=0.7 (è¶…ç›´æ¥é€šè·¯æ ‘çªè¾ƒçŸ­)

### ä¿®æ”¹æ–‡ä»¶

- `src/region/neuromod/vta_da.h`: æ·»åŠ  `tonic_firing_smooth_`, `step_count_`, `WARMUP_STEPS`
- `src/region/neuromod/vta_da.cpp`: firing-rate-based DA + warmup
- `src/engine/closed_loop_agent.cpp`: Phase A æ—¶åºä¿®æ­£ (bg read DA after step)
- `src/region/subcortical/basal_ganglia.h`: æ·»åŠ  `CTX_MSN_PSP_DECAY=0.9`
- `src/region/subcortical/basal_ganglia.cpp`: D1/D2 ç”¨ CTX_MSN_PSP_DECAY

### æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | å˜åŒ– |
|------|--------|--------|------|
| DA level | **0.300 æ’å®š** | **0.273-0.300 (åŠ¨æ€)** | âœ… DA é€šè·¯æ¿€æ´» |
| D1 fires (50æ­¥) | 0 | 2 | âœ… ä»é›¶åˆ°éé›¶ |
| D2 fires (50æ­¥) | 0 | 3 | âœ… |
| Max eligibility | 0.0 | 6.6 | âœ… |
| Weight range | 0.0008 | **0.0045** | âœ… 5.6Ã— |
| Learner advantage | ~0 | **+0.020** | âœ… |

### é—ç•™é—®é¢˜ (æœªæ¥ Step)

- D1 MSN å‘æ”¾ä»ç„¶ç¨€ç– (2/950 engine steps)ï¼Œæ ¹å› æ˜¯çš®å±‚è¾“å…¥å¤ªç¨€ç–
- DA dip åœ¨ Phase A æœŸé—´å‘ç”Ÿ (~0.12)ï¼Œä½† Phase B ç»“æŸæ—¶æ¢å¤åˆ° ~0.30
- æƒé‡èŒƒå›´ 0.0045 è™½ç„¶ 5.6Ã— æ”¹å–„ï¼Œä½†ç»å¯¹å€¼ä»ç„¶è¾ƒå°
- éœ€è¦æ›´å¤šçš®å±‚â†’BG é€šè·¯æˆ–æ›´é«˜çš®å±‚å‘æ”¾ç‡æ¥å¢åŠ  D1 co-activation

### ç³»ç»ŸçŠ¶æ€

```
54åŒºåŸŸ Â· ~146é—­ç¯ç¥ç»å…ƒ Â· ~112æŠ•å°„
VTA DA: firing-rate-based (ä¿®å¤ 3 ä¸ª bug)
çš®å±‚â†’MSN PSP: 0.7 â†’ 0.9 (D1 å¯ä»¥å‘æ”¾)
30/30 CTest é€šè¿‡
```

---

## Step 38: ä¸˜è„‘-çº¹çŠ¶ä½“ç›´æ¥é€šè·¯ (Thalamostriatal Pathway)

> æ—¥æœŸ: 2026-02-09
> æ ¸å¿ƒçªç ´: D1 å‘æ”¾ 2â†’36 (18Ã—), æƒé‡èŒƒå›´ 0.0045â†’0.0165 (3.7Ã—), 2000æ­¥é¦–æ¬¡æ­£å‘æ”¹å–„ +0.212

### é—®é¢˜è¯Šæ–­

**è§†è§‰å±‚çº§å»¶è¿Ÿè¶…è¿‡ brain_steps_per_action**
```
LGN â†’ V1 â†’ V2 â†’ V4 â†’ IT â†’ dlPFC â†’ BG
 d=2   d=2   d=2   d=2   d=2    d=2
           æœ€å°‘éœ€è¦ ~14 æ­¥åˆ°è¾¾ BG
```
- `brain_steps_per_action=12` < 14 æ­¥å»¶è¿Ÿ
- dlPFC L5 åœ¨ç¬¬ 14 æ­¥æ‰å¼€å§‹å‘æ”¾ â†’ å‡ ä¹æ— çš®å±‚è„‰å†²åœ¨ä¸€ä¸ª agent step å†…åˆ°è¾¾ BG
- ç»“æœ: ~2.3 cortical events/step, D1 å‘æ”¾ 2 æ¬¡/950 engine steps

### è§£å†³æ–¹æ¡ˆ: LGNâ†’BG ç›´æ¥æŠ•å°„

**äººè„‘è§£å‰–å­¦äº‹å®** (Smith et al. 2004, Lanciego et al. 2012):
- æ¿å†…æ ¸ç¾¤ (CM/Pf) ç›´æ¥æŠ•å°„åˆ°çº¹çŠ¶ä½“ MSN
- ç¼–ç è¡Œä¸ºæ˜¾è‘—æ€§ (Matsumoto et al. 2001)ï¼Œä¸ç¼–ç æ–¹å‘
- MSN up-state éœ€è¦ä¸˜è„‘+çš®å±‚ä¸¤æ¡é€šè·¯ååŒ (Stern et al. 1998)

```
å¿«é€šè·¯ (thalamostriatal): LGN â†’ BG (delay=1, 1è·³)
  â†’ MSN è·å¾—"æœ‰ä¸œè¥¿å‡ºç°"çš„ç²—ç³™ä¿¡å· â†’ ç»´æŒ up-state firing
  â†’ ä¸å‚ä¸ DA-STDP å­¦ä¹ 

æ…¢é€šè·¯ (corticostriatal): LGN â†’ V1 â†’ ... â†’ dlPFC â†’ BG (delay=14, 6è·³)
  â†’ MSN è·å¾—"é‚£æ˜¯é£Ÿç‰©/å±é™©, åœ¨å·¦/å³"çš„ç²¾ç»†ä¿¡å·
  â†’ DA-STDP å­¦ä¹ çš„æ˜¯è¿™æ¡é€šè·¯çš„æƒé‡
```

### å®ç°ç»†èŠ‚

**BG::receive_spikes() åŒºåˆ†ä¸˜è„‘/çš®å±‚è„‰å†²:**
- ä¸˜è„‘è„‰å†²: å¹¿æ³›æŠ•å°„åˆ° ALL D1/D2 ç¥ç»å…ƒ, å¼±ç”µæµ 8.0 pA, ä¸æ ‡è®° input_active_
- çš®å±‚è„‰å†²: é€šè¿‡å­¦ä¹ æƒé‡çš„æ‹“æ‰‘æ˜ å°„, 30 pA, æ ‡è®° input_active_ å‚ä¸ DA-STDP

### ä¿®æ”¹æ–‡ä»¶

- `src/engine/closed_loop_agent.cpp`: æ·»åŠ  `LGNâ†’BG` æŠ•å°„ (delay=1) + æ³¨å†Œä¸˜è„‘æº
- `src/region/subcortical/basal_ganglia.h`: æ·»åŠ  `thalamic_source_`, `THAL_MSN_CURRENT`, `set_thalamic_source()`
- `src/region/subcortical/basal_ganglia.cpp`: receive_spikes() åŒºåˆ†ä¸˜è„‘/çš®å±‚é€šè·¯

### æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | Step 37 (VTAä¿®å¤) | Step 38 (ä¸˜è„‘é€šè·¯) | å˜åŒ– |
|------|--------|--------|------|
| D1 fires (50æ­¥) | 2 | **36** | **18Ã—** |
| D2 fires (50æ­¥) | 3 | **36** | **12Ã—** |
| Max eligibility | 6.6 | **10.9** | +65% |
| Weight range | 0.0045 | **0.0165** | **3.7Ã—** |
| Elig at danger | 0.0-1.7 | **1.9-5.3** | âœ… éé›¶ |
| 2000æ­¥ Improvement | -0.350 | **+0.212** | âœ… **æ­£å€¼ï¼** |

### ä¸ºä»€ä¹ˆæœ‰æ•ˆ

1. LGN æ¯ä¸ª brain step éƒ½å‘æ”¾ â†’ æ¯æ­¥ ~25 ä¸ª spike åˆ°è¾¾ BG (delay=1)
2. æ¯ä¸ªä¸˜è„‘ spike ç»™ ALL D1/D2 æ³¨å…¥ 8.0 pA â†’ D1 ç´¯ç§¯ PSP è¿œè¶…é˜ˆå€¼
3. D1 é¢‘ç¹å‘æ”¾ â†’ ä¸çš®å±‚ spike (è™½ç„¶ 14 æ­¥åæ‰åˆ°) co-activate â†’ çœŸæ­£çš„ STDP é…å¯¹
4. Eligibility trace åœ¨ danger å‘ç”Ÿæ—¶éé›¶ â†’ DA-STDP å¯ä»¥å­¦ä¹ 

### ç³»ç»ŸçŠ¶æ€

```
54åŒºåŸŸ Â· ~146é—­ç¯ç¥ç»å…ƒ Â· ~113æŠ•å°„
VTA DA: firing-rate-based + ä¸˜è„‘-çº¹çŠ¶ä½“ç›´æ¥é€šè·¯
D1 å‘æ”¾ 36/50æ­¥ (ä» 2 â†’ 18Ã— æå‡)
2000æ­¥ Improvement: +0.212 (é¦–æ¬¡æ­£å€¼!)
30/30 CTest é€šè¿‡
```
